(window.webpackJsonp=window.webpackJsonp||[]).push([[2],Array(18).concat([function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(30)),r=(i(n(19)),function(){function e(){(0,s.default)(this,e),this._name="",this._x=0,this._y=0,this._width=100,this._height=30,this._zIndex=0,this._ontouchstart=function(){},this._ontouchmove=function(){},this._ontouchend=function(){},this._onload=function(){},this.visible=!1,this.loaded=!1,this.touchable=!1,this.touched=!1,this.eventEmitter=new a.default,this.eventEmitter.setMaxListeners(3e3),this.isComponent=!0,this.props=["name","x","y","width","height","ontouchstart","ontouchmove","ontouchend","onload","zIndex"],this.index=e.Index++}return(0,o.default)(e,[{key:"Start",value:function(){}},{key:"Update",value:function(){}},{key:"End",value:function(){}},{key:"setTouchable",value:function(e){this.touchable=e,this.parent&&e&&this.parent.setTouchable&&this.parent.setTouchable(e)}},{key:"isScope",value:function(e){var t=e.x,n=e.y;return t>=this._x&&t<=this._x+this._width&&n>=this._y&&n<=this._y+this._height}},{key:"addEventListener",value:function(e,t){this.touchable&&this.eventEmitter.on(e,t)}},{key:"removeEventListener",value:function(e,t){this.touchable&&this.eventEmitter.removeListener(e,t)}},{key:"emitTouchMove",value:function(e){this.touchable&&(this.eventEmitter.emit("touchmove",e),console.log("component","touchmove",e),this._ontouchmove(e))}},{key:"emitTouchStart",value:function(e){this.touchable&&(this.touched=!0,this.eventEmitter.emit("touchstart",e),console.log("component","touchstart",e),this._ontouchstart(e))}},{key:"emitTouchEnd",value:function(e){this.touchable&&(this.touched=!1,this.eventEmitter.emit("touchend",e),console.log("component","touchend",e),this._ontouchend(e))}},{key:"name",set:function(e){this._name=e}},{key:"x",set:function(e){this._x=e}},{key:"y",set:function(e){this._y=e}},{key:"width",set:function(e){this._width=e}},{key:"height",set:function(e){this._height=e}},{key:"zIndex",set:function(e){this._zIndex=e}},{key:"ontouchstart",set:function(e){this._ontouchstart=e}},{key:"ontouchmove",set:function(e){this._ontouchmove=e}},{key:"ontouchend",set:function(e){this._ontouchend=e}},{key:"onload",set:function(e){this._onload=e}}]),e}());t.default=r,r.Index=0},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(129)),r=function(){function e(){var t=this;(0,s.default)(this,e),this.setComponentMap=function(e){e._name&&!t.componentMap[e._name]&&(t.componentMap[e._name]=e),e.children.map(function(e){t.setComponentMap(e)})},this.onTouchStart=function(e){console.log("touchstart",e);var n=e.touches;if(n.length>=0){t.touched=!0;var i={x:n[0].pageX,y:n[0].pageY};t.children.filter(function(e){return e.touchable&&e.isScope(i)}).forEach(function(t){t.emitTouchStart(e)})}},this.onTouchMove=function(e){if(console.log("touchmove",e),t.touched){var n=e.touches;if(n.length>=0){n[0].pageX,n[0].pageY;t.children.filter(function(e){return e.touchable&&e.touched}).forEach(function(t){t.emitTouchMove(e)})}}},this.onTouchEnd=function(e){console.log("touchend",e),t.touched=!1,t.children.filter(function(e){return e.touchable&&e.touched}).forEach(function(t){t.emitTouchEnd(e)})},this.params={},this.touched=!1,this.paused=!1,this.children=[],this.controllers=[],this.store=null,this.componentMap={},this.soundManager=new a.default}return(0,o.default)(e,[{key:"Init",value:function(e){this.canvas=e,this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.context=e.getContext("2d",{antialias:!0}),this.context.clearRect(0,0,window.innerWidth,window.innerHeight),this.bindEvent(),this.Start(e)}},{key:"Start",value:function(){}},{key:"Render",value:function(){this.paused?this.pauseControllers():(this.WillUpdate(),this.updateChildren(),this.updateControllers(),this.updateSoundManager(),this.Update())}},{key:"updateChildren",value:function(){var e=this;this.children.filter(function(e){return e.visible}).sort(function(e,t){return e._zIndex==t._zIndex?e.index<t.index:e._zIndex>t._zIndex}).forEach(function(t){t.context?t.Update():(t.parent=e,t.context=e.context,t.Start()),e.setComponentMap(t)})}},{key:"updateControllers",value:function(){var e=this;this.controllers.filter(function(e){return e.visible}).forEach(function(t){t.context?t.Update():(t.parent=e,t.store=e.store,t.context=e.context,t.Start())})}},{key:"updateSoundManager",value:function(){this.soundManager.loaded?this.soundManager.Update():this.soundManager.Start()}},{key:"pauseControllers",value:function(){this.controllers.filter(function(e){return e.visible}).forEach(function(e){e.Pause()})}},{key:"WillUpdate",value:function(){}},{key:"Update",value:function(){}},{key:"Unload",value:function(){this.unbindEvent(),this.End()}},{key:"End",value:function(){}},{key:"bindEvent",value:function(){this.canvas.addEventListener("touchstart",this.onTouchStart),this.canvas.addEventListener("touchmove",this.onTouchMove),this.canvas.addEventListener("touchend",this.onTouchEnd)}},{key:"unbindEvent",value:function(){this.canvas.removeEventListener("touchstart",this.onTouchStart),this.canvas.removeEventListener("touchmove",this.onTouchMove),this.canvas.removeEventListener("touchend",this.onTouchEnd)}}]),e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={direction:{w:{x:0,y:1},s:{x:0,y:-1},a:{x:-1,y:0},d:{x:1,y:0}},gridCount:20,CA_CLEAR:1,CA_TRAIL:2,enemyV:.05,playerV:1,playerSize:.7,monsterScores:[10,50,100],blocksScores:function(e){return e>20?5*e:e>15?4*e:e>10?3*e:e>5?2*e:e>1?1*e:void 0}}},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(30)),r=function(){function e(){(0,s.default)(this,e),this.visible=!1,this.eventEmitter=new a.default,this.eventEmitter.setMaxListeners(3e3),this.isModel=!0,this.clock=new THREE.Clock,this.position={x:0,y:0,z:0},this.up={x:0,y:0,z:1},this.forward={x:0,y:1,z:0}}return(0,o.default)(e,[{key:"Start",value:function(){}},{key:"Update",value:function(){}},{key:"End",value:function(){}}]),e}();t.default=r},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s={current:{path:"/404",params:{},scene:new(i(n(19)).default),store:null},scenes:[],history:[],init:function(){this.current.scene.canvas=window.canvas?window.canvas:document.createElement("canvas")},addRoute:function(e,t){this.scenes.push({path:e,scene:t})},removeRoute:function(e){var t=this.scenes.findIndex(function(t){return t.path===e});if(-1===t)return!1;this.scenes.splice(t,1)},push:function(e,t){var n=this.scenes.findIndex(function(t){return t.path===e});if(-1!==n){var i=this.scenes[n].scene;return this.current.scene.Unload(),i.Init(this.current.scene.canvas),this.current={path:e,params:t,scene:i,store:this.current.store},this.current.scene.params=this.current.params,this.current.scene.store=this.current.store,this.history.push(this.current),this.current}return!1},reset:function(e,t){var n=this.scenes.findIndex(function(t){return t.path===e});if(-1!==n){var i=this.scenes[n].scene;return this.current.scene.Unload(),i.Init(this.current.scene.canvas),this.current={path:e,params:t,scene:i,store:this.current.store},this.current.scene.params=this.current.params,this.current.scene.store=this.current.store,this.history=[this.current],this.current}return!1},pop:function(){return this.history.length>=1&&(this.current.scene.Unload(),this.history.pop())},getCurrent:function(){return this.current}};t.default=s},,,,,,function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(30)),r=function(){function e(){(0,s.default)(this,e),this.visible=!0,this.eventEmitter=new a.default,this.eventEmitter.setMaxListeners(3e3),this.isController=!0,this.clock=new THREE.Clock,this.paused=!1}return(0,o.default)(e,[{key:"Start",value:function(){}},{key:"Update",value:function(){this.paused&&(this.paused=!1),this.clock.running||this.clock.start()}},{key:"Pause",value:function(){this.clock.stop(),this.paused=!0}},{key:"End",value:function(){}}]),e}();t.default=r},,,,,,,,,,,,function(e,t,n){var i=n(229);(e.exports=n(228)(!1)).push([e.i,"body {\n  font-family: Monospace;\n  background-color: #000;\n  color: #000;\n  margin: 0px;\n  overflow: hidden;\n}\n@font-face {\n  font-family: 'NUMBER';\n  src: url("+i(n(227))+") format('truetype'), url("+i(n(226))+") format('svg');\n  font-weight: normal;\n  font-style: normal;\n}\n",""])},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={direction:"w",position:{x:0,y:0},prevPosition:{x:0,y:0}};t.default=i},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4)),h=i(n(18)),c=i(n(69)),l=i(n(44)),d=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this)))._background=new c.default,e._content=new l.default(""),e.visible=!0,e.touchable=!0,e.isCButton=!0,e.props=e.props.concat(["background","content"]),e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"Start",value:function(){this.loaded=!0}},{key:"Update",value:function(){this.visible&&this.loaded&&this.updateChildren()}},{key:"updateChildren",value:function(){var e=this;[this._background,this._content].filter(function(e){return e.visible}).forEach(function(t){t.context?t.Update():(t.parent=e,t.context=e.context,t.Start())})}},{key:"End",value:function(){}},{key:"background",set:function(e){this._background=e}},{key:"content",set:function(e){this._content=e}},{key:"x",set:function(e){this._x=e,this._background.x=e,this._content.x=e}},{key:"y",set:function(e){this._y=e,this._background.y=e,this._content.y=e}},{key:"width",set:function(e){this._width=e,this._background.width=e,this._content.height=e}},{key:"height",set:function(e){this._height=e,this._background.height=e,this._content.height=e}}]),t}(h.default);t.default=d},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4)),h=function(e){function t(e){var n;return(0,s.default)(this,t),(n=(0,a.default)(this,(0,r.default)(t).call(this)))._content=e,n._textAlign="left",n._textAlignVertical="top",n._fontSize=12,n._fontFamily="Arial",n._color="black",n.visible=!0,n.calculate_x=0,n.calculate_y=0,n.isCText=!0,n.props=n.props.concat(["content","textAlign","textAlignVertical","fontSize","fontFamily","color"]),n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"Start",value:function(){this.loaded=!0,this._onload()}},{key:"calculate",value:function(){switch(this.calculate_font=this._fontSize+"px "+this._fontFamily,this.calculate_height=this._fontSize+2,this.calculate_width=this.context.measureText(this._content).width,this._textAlign){case"left":this.calculate_x=this._x;break;case"right":this.calculate_x=this._x+this._width-this.calculate_width;break;case"center":this.calculate_x=this._x+(this._width-this.calculate_width)/2;break;default:this.calculate_x=this._x}switch(this._textAlignVertical){case"top":this.calculate_y=this._y+this.calculate_height/2;break;case"bottom":this.calculate_y=this._y+(this._height-this.calculate_height/2);break;case"center":this.calculate_y=this._y+this._height/2+this.calculate_height/2;break;default:this.calculate_y=this._y}}},{key:"Update",value:function(){this.visible&&this.loaded&&this._content&&(this.calculate(),this.context.font=this.calculate_font,this.context.fillStyle=this._color,this.context.fillText(this._content,this.calculate_x,this.calculate_y))}},{key:"End",value:function(){}},{key:"content",set:function(e){this._content=e}},{key:"textAlign",set:function(e){this._textAlign=e}},{key:"textAlignVertical",set:function(e){this._textAlignVertical=e}},{key:"fontSize",set:function(e){this._fontSize=e}},{key:"fontFamily",set:function(e){this._fontFamily=e}},{key:"color",set:function(e){this._color=e}}]),t}(i(n(18)).default);t.default=h},,,function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(46)),o=i(n(2)),a=i(n(1)),r=function(){function e(t){(0,o.default)(this,e),this.index=e.Index++,this.state={},this.store=null,this.name=t}return(0,a.default)(e,[{key:"setStore",value:function(e){this.store=e}},{key:"persist",value:function(){this.store.setUnit(this.name,this),this.store.setState(this.name,this.state)}},{key:"restore",value:function(){this.setState(this.store.getUnit(this.name))}},{key:"setState",value:function(e){var t=(0,s.default)({},this.state,e);this.state=t}},{key:"getState",value:function(){return this.state}}]),e}();t.default=r,r.Index=0},,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=function(){function e(t,n,i,o){(0,s.default)(this,e),this.size=t||10,this.divisions=n||10,this.material1=i,this.material2=o,this.center=this.divisions/2,this.step=this.size/this.divisions,this.halfSize=this.size/2,this.vertices=[],this.faces=[],this.materials=[this.material1,this.material2],this.faceVertexUvs=[[]];for(var a=-this.halfSize;a<this.halfSize-1;a++)for(var r=-this.halfSize;r<this.halfSize-1;r++){var u,h,c=[new THREE.Vector3(a,0,r),new THREE.Vector3(a+1,0,r),new THREE.Vector3(a+1,0,r+1),new THREE.Vector3(a,0,r+1)],l=this.vertices.length,d=this.faces.length,f=[new THREE.Face3(l+0,l+1,l+2),new THREE.Face3(l+0,l+2,l+3)];f.forEach(function(e){e.normal=new THREE.Vector3(0,0,1),e.vertexNormals=[new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,1)]}),(u=this.faces).push.apply(u,f),this.faceVertexUvs[0][d+0]=[new THREE.Vector2(0,0),new THREE.Vector2(0,1),new THREE.Vector2(1,1)],this.faceVertexUvs[0][d+1]=[new THREE.Vector2(0,0),new THREE.Vector2(1,1),new THREE.Vector2(1,0)],(h=this.vertices).push.apply(h,c)}this.geometry=new THREE.Geometry,this.geometry.vertices=this.vertices,this.geometry.faces=this.faces,this.geometry.faceVertexUvs=this.faceVertexUvs,this.mesh=new THREE.Mesh(this.geometry,this.materials)}return(0,o.default)(e,[{key:"updateFaceIndex",value:function(e){var t={};e.map(function(e){var n=e.x,i=e.y;t["positions:"+n+"_"+-i]=1}),this.faces=[];for(var n=-this.halfSize;n<this.halfSize-1;n++)for(var i=-this.halfSize;i<this.halfSize-1;i++){var s,o=2*this.faces.length,a=[new THREE.Face3(o+0,o+1,o+2),new THREE.Face3(o+0,o+2,o+3)];a.forEach(function(e){e.normal=new THREE.Vector3(0,0,1),e.vertexNormals=[new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,1)],t["positions:"+n+"_"+i]&&(e.materialIndex=1)}),(s=this.faces).push.apply(s,a)}this.geometry.faces=this.faces,this.geometry.elementsNeedUpdate=!0}}]),e}();t.default=a},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(46)),o=i(n(2)),a=i(n(1)),r=i(n(5)),u=i(n(3)),h=i(n(4)),c=function(e){function t(){var e;return(0,o.default)(this,t),(e=(0,r.default)(this,(0,u.default)(t).call(this))).mesh=null,e.mixer=null,e.paused=!0,e.meshes=new THREE.Group,e.scale=.005,e.meshes.scale.set(e.scale,e.scale,e.scale),e.meshes.rotateX(THREE.Math.degToRad(90)),e.meshes.rotateY(THREE.Math.degToRad(180)),e.visible=!0,e}return(0,h.default)(t,e),(0,a.default)(t,[{key:"Start",value:function(){this.scene.add(this.meshes)}},{key:"createMaterials",value:function(e){for(var t=[],n=0;n<e.materials.length;++n){var i=new THREE.MeshPhongMaterial({});i.copy(e.materials[n]),t.push(i)}return t}},{key:"preload",value:function(e){var n=this;if(!this.loaded){var i=this;(new THREE.JDLoader).load(e,function(e){for(var s=0;s<e.objects.length;++s)if("Mesh"==e.objects[s].type||"SkinnedMesh"==e.objects[s].type){var o=null,a=n.createMaterials(e);if((o="SkinnedMesh"==e.objects[s].type?new THREE.SkinnedMesh(e.objects[s].geometry,a):new THREE.Mesh(e.objects[s].geometry,a))&&o.geometry.animations){var r=new THREE.AnimationMixer(o);o.mixer=r,t.mixers.push(r),r.clipAction(o.geometry.animations[0]).play()}o&&n.meshes.add(o)}i.loaded=!0})}}},{key:"born",value:function(e){this.updatePosition(e)}},{key:"updateDirection",value:function(e){var t=this.clock.getDelta();if(this.paused&&this.meshes.children.length>0)for(var n=0;n<this.meshes.children.length;n++){var i=this.meshes.children[n];i&&i.mixer&&i.mixer.update(t)}if(this.direction!==e&&this.meshes.children.length>0)switch(e){case"w":this.meshes.rotation.set(Math.PI/2,Math.PI,0,"XYZ");break;case"s":this.meshes.rotation.set(Math.PI/2,0,0,"XYZ");break;case"a":this.meshes.rotation.set(Math.PI/2,-Math.PI/2,0,"XYZ");break;case"d":this.meshes.rotation.set(Math.PI/2,Math.PI/2,0,"XYZ")}this.direction=e;var s=new THREE.Vector3(0,0,-1);s.applyQuaternion(this.meshes.quaternion),s.normalize(),this.forward=s}},{key:"play",value:function(e){for(var t=0;t<this.meshes.children.length;t++){var n=this.meshes[t];if(n&&n.geometry.animations&&n.mixer){var i=n.geometry.animations,s=THREE.AnimationClip.findByName(i,e);n.mixer.clipAction(s).play()}}this.paused=!1}},{key:"stop",value:function(){this.paused=!0}},{key:"updatePosition",value:function(e){this.loaded&&(this.position=(0,s.default)({},e,{z:.01}),this.meshes.position.x=this.position.x,this.meshes.position.y=this.position.y)}}]),t}(i(n(21)).default);t.default=c,c.mixers=[]},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(29)),h=i(n(4)),c=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this)))._gutter={h:0,v:0},e._layout={d:"h",h:"center",v:"center"},e.props=e.props.concat(["gutter","layout"]),e.visible=!0,e.children=[],e._ontouchstart=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.children.forEach(function(e){e.emitTouchStart.apply(e,n)})},e._ontouchmove=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.children.forEach(function(e){e.emitTouchMove.apply(e,n)})},e._ontouchend=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.children.forEach(function(e){e.emitTouchEnd.apply(e,n)})},e}return(0,h.default)(t,e),(0,o.default)(t,[{key:"Start",value:function(){this.loaded=!0,this._onload()}},{key:"Update",value:function(){this.visible&&this.loaded&&this.updateChildren()}},{key:"updateChildren",value:function(){var e=this,t=this.children.filter(function(e){return e.visible});if("h"===this._layout.d){var n,i=t.reduce(function(e,t,n,i){return e+t._width},0)+(t.length-1)+this._gutter.h;switch(this._layout.h){case"center":n=this._x+(this._width-i)/2;break;case"left":n=this._x;break;case"right":n=this._x+this._width-i;break;default:n=this._x+(this._width-i)/2}t.forEach(function(t){var i,s=n;switch(e._layout.v){case"center":i=e._y+e._height/2-t._height/2;break;case"top":i=e._y;break;case"bottom":i=e._y+e._height-t._height;break;default:i=e._y+e._height/2-t._height/2}t.x=s,t.y=i,n=s+t._width+e._gutter.h})}else{var s,o=t.reduce(function(e,t,n,i){return e+t._height},0)+(t.length-1)+this._gutter.v;switch(this._layout.v){case"center":s=this._y+(this._height-o)/2;break;case"top":s=this._y;break;case"bottom":s=this._y+this._height-o;break;default:s=this._y+this._height/2-o/2}this._x,this._width;t.forEach(function(t){var n,i=s;switch(e._layout.h){case"center":n=e._x+(e._width-t._width)/2;break;case"left":n=e._x;break;case"right":n=e._x+e._width-t._width;break;default:n=e._x+(e._width-t._width)/2}t.x=n,t.y=i,s=i+t._height+e._gutter.v})}t.forEach(function(t){t.context?t.Update():(t.parent=e,t.context=e.context,t.Start(),e.setTouchable(t.touchable))})}},{key:"End",value:function(){}},{key:"isScope",value:function(e){var n=e.x,i=e.y;if((0,u.default)((0,r.default)(t.prototype),"isScope",this).call(this,{x:n,y:i}))return!0;for(var s=this.children.filter(function(e){return e.visible}),o=0;o<s.length;o++)if(s[o].isScope({x:n,y:i}))return!0;return!1}},{key:"layout",set:function(e){var t=e.d,n=e.h,i=e.v;this._layout={d:t,h:n,v:i}}},{key:"gutter",set:function(e){var t=e.h,n=e.v;this._gutter={h:t,v:n}}}]),t}(i(n(18)).default);t.default=c},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4)),h=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this))).visible=!0,e._backgroundColor="black",e.isCRect=!0,e.props=e.props.concat(["backgroundColor"]),e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"Start",value:function(){this.loaded=!0,this._onload()}},{key:"Update",value:function(){this.visible&&this.loaded&&(this.context.fillStyle=this._backgroundColor,this.context.rect(this._x,this._y,this._width,this._height),this.context.fill())}},{key:"End",value:function(){}},{key:"backgroundColor",set:function(e){this._backgroundColor=e}}]),t}(i(n(18)).default);t.default=h},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4)),h=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this))).visible=!0,e.source="",e.isCImage=!0,e.props=e.props.concat(["src"]),e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"setSource",value:function(e){var t=this;this.img&&this.img.remove();var n=this,i=document.createElement("img");i.onload=function(){n.loaded=!0,t._onload&&t._onload()},i.src=e,this.source=e,this.img=i}},{key:"Start",value:function(){var e=this,t=this,n=document.createElement("img");n.onload=function(){t.loaded=!0,e._onload&&e._onload()},n.src=this.source,this.img=n}},{key:"Update",value:function(){this.visible&&this.loaded&&this.img&&this.context&&this.context.drawImage(this.img,this._x,this._y,this._width,this._height)}},{key:"End",value:function(){this.img.remove()}},{key:"src",set:function(e){this.source=e,this.setSource(e)}}]),t}(i(n(18)).default);t.default=h},function(e,t,n){"use strict";function i(e,t){var n=new e;t&&n.props.forEach(function(e){t[e]&&(n[e]=t[e])});for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];return n.children=s,n.children.forEach(function(e){e.parent=n}),n}Object.defineProperty(t,"__esModule",{value:!0}),t.JSXComponent=i,t.default=void 0;var s={JSXComponent:i};t.default=s},,,function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(65)),o=i(n(73)),a=i(n(72)),r=i(n(2)),u=i(n(1)),h=function(){function e(t){(0,r.default)(this,e),this.target={position:{x:0,y:0,z:0}},this.index=e.Index++,this.sourceType="audio",this.source=t,this.sourceNode=null,this.volume=0,this.volumeNode=null,this.playing=!1,this.paused=!1,this.loaded=!1,this.visible=!1,this.loop=!1,this.loopType="forever",this.playTime=0}var t,n;return(0,u.default)(e,[{key:"bindTarget",value:function(e){this.target=e}},{key:"bindSource",value:(n=(0,a.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.createBufferSource(t);case 2:this.sourceNode=e.sent,this.sourceType="audio",this.sourceNode&&(this.source=t,this.volumeNode=this.ctx.createGain(),this.createPannerNode(),this.sourceNode.connect(this.pannerNode),this.pannerNode.connect(this.volumeNode),this.volumeNode.connect(this.ctx.destination)),this.loaded=!0;case 6:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"createBufferSource",value:(t=(0,a.default)(o.default.mark(function e(t){var n=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new s.default(function(e,i){try{var s=n.ctx.createBufferSource(),o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){var t=o.response;n.ctx.decodeAudioData(t,function(t){s.buffer=t,s.loop=n.loop,e(s)})},o.send()}catch(e){i(e)}}));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"createPannerNode",value:function(){var e=this.ctx.createPanner();this.pannerNode=e}},{key:"play",value:function(){this.playing=!0,this.paused=!1,this.sourceNode.start(0)}},{key:"puase",value:function(){this.playing=!1,this.paused=!0,this.sourceNode.stop(this.playTime)}},{key:"stop",value:function(){this.playing=!1,this.puased=!0,this.playTime=0,this.sourceNode.stop(0)}},{key:"Start",value:function(){this.source&&this.bindSource(this.source),this.visible=!0}},{key:"Update",value:function(){if(this.ctx&&this.loaded&&this.target&&this.target.position){var e=this.target.position;this.pannerNode.positionX?(this.pannerNode.positionX.setValueAtTime(e.x,this.ctx.currentTime),this.pannerNode.positionY.setValueAtTime(e.y,this.ctx.currentTime),this.pannerNode.positionZ.setValueAtTime(e.z,this.ctx.currentTime)):this.pannerNode.setPosition(e.x,e.y,e.z)}}},{key:"End",value:function(){this.loaded=!1,this.visible=!1}}]),e}();t.default=h,h.Index=0},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.getToken=function(){return s.default.get(o)},t.setToken=function(e){return s.default.set(o,e,{expires:29})},t.removeToken=function(){return s.default.remove(o)};var s=i(n(223)),o="AuthKey"},function(e,t,n){"use strict";var i=n(31),s=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(n(2)),a=s(n(1)),r=s(n(5)),u=s(n(3)),h=s(n(4)),c=i(n(41)),l=function(e){function t(){var e;return(0,o.default)(this,t),(e=(0,r.default)(this,(0,u.default)(t).call(this))).onWindowResize=function(){e.engine.resize()},e.renderCanvas=document.createElement("canvas"),e.engine=new c.Engine(e.renderCanvas,!0),e.scene=new c.Scene(e.engine),e.camera=new c.FreeCamera("camera",new c.Vector3(0,0,3),e.scene),e.camera.setTarget(c.Vector3.Zero()),e.camera.attachControl(e.renderCanvas,!1),e.models=[],e}return(0,h.default)(t,e),(0,a.default)(t,[{key:"Init",value:function(e){var t=this;this.canvas=e,this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.context=e.getContext("2d"),this.context.clearRect(0,0,window.innerWidth,window.innerHeight),this.renderCanvas.width=window.innerWidth,this.renderCanvas.height=window.innerHeight,this.Start(),this.engine.runRenderLoop(function(){t.paused?t.pauseControllers():(t.scene.render(),t.context.drawImage(t.renderCanvas,0,0),t.WillUpdate(),t.updateChildren(),t.updateControllers(),t.updateModels(),t.Update())}),window.addEventListener("resize",this.onWindowResize)}},{key:"Start",value:function(){}},{key:"Render",value:function(){}},{key:"WillUpdate",value:function(){}},{key:"Update",value:function(){}},{key:"Unload",value:function(){window.removeEventListener("resize",this.onWindowResize),this.End()}},{key:"End",value:function(){}},{key:"updateModels",value:function(){var e=this;this.models.filter(function(e){return e.visible}).forEach(function(t){t.context?t.Update():(t.parent=e,t.context=e.context,t.scene=e.scene,t.camera=e.camera,t.Start())})}}]),t}(s(n(19)).default);t.default=l},function(e,t,n){"use strict";var i=n(31),s=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(n(73)),a=s(n(72)),r=s(n(2)),u=s(n(1)),h=s(n(5)),c=s(n(3)),l=s(n(4)),d=i(n(41)),f=function(e){function t(){return(0,r.default)(this,t),(0,h.default)(this,(0,c.default)(t).apply(this,arguments))}var n;return(0,l.default)(t,e),(0,u.default)(t,[{key:"Start",value:(n=(0,a.default)(o.default.mark(function e(){var t,n,i,s,a,r,u=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return new d.HemisphericLight("light1",new d.Vector3(0,1,0),this.scene),this.ground=d.Mesh.CreateGround("ground1",100,100,100,this.scene),(t=new d.StandardMaterial("mat0",this.scene)).diffuseColor=new d.Color3(1,0,0),(n=new d.StandardMaterial("mat1",this.scene)).diffuseColor=new d.Color3(0,0,1),(i=new d.StandardMaterial("mat2",this.scene)).diffuseColor=new d.Color3(0,1,0),(s=new d.MultiMaterial("multi",this.scene)).subMaterials.push(t),s.subMaterials.push(n),s.subMaterials.push(i),this.ground.material=s,a=this.ground.getTotalVertices(),this.ground.subMeshes.push(new d.SubMesh(2,0,a,0,12e3,this.ground)),this.ground.scaling.set(6,1,6),this.ground.subMeshes.push(new d.SubMesh(1,0,a,12e3,12e3,this.ground)),this.ground.subMeshes.push(new d.SubMesh(2,0,a,24e3,12e3,this.ground)),e.next=20,d.SceneLoader.LoadAssetContainerAsync("../../assets/babylon/","hero.babylon",this.scene);case 20:this.hero=e.sent,this.hero.addAllToScene(),r=this.hero.meshes[0].position,this.ground.position.set(r.x,r.y,r.z),this.camera.position.set(0,440,-850),this.camera.setTarget(this.hero.meshes[0].position),setTimeout(function(){u.scene.stopAllAnimations(),u.die()},1e4),this.run();case 28:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"Update",value:function(){}},{key:"End",value:function(){}},{key:"run",value:function(){this.scene.beginAnimation(this.hero.skeletons[0],0,18,!0,1),this.scene.beginAnimation(this.hero.skeletons[1],0,18,!0,1)}},{key:"die",value:function(){this.scene.beginAnimation(this.hero.skeletons[0],25,50,!1,1),this.scene.beginAnimation(this.hero.skeletons[1],25,50,!1,1)}}]),t}(s(n(104)).default);t.default=f},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(29)),h=i(n(4));var c=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this))).meshes=new THREE.Group,e.visible=!0,e.shaderMesh=null,e.InitShader(),e}return(0,h.default)(t,e),(0,o.default)(t,[{key:"Start",value:function(){this.scene.add(this.meshes)}},{key:"Update",value:function(){(0,u.default)((0,r.default)(t.prototype),"Update",this).call(this);var e=this.clock.getDelta();this.shaderMesh&&(this.shaderMesh.material.uniforms.time.value+=.5*e)}},{key:"updatePosition",value:function(e){var t={x:e.x,y:e.y,z:.01};this.meshes.position.set(t.x,t.y,t.z);for(var n,i=this.shaderMesh.material.uniforms.time.value,s=this.shaderMesh.geometry.attributes.birthTime,o=this.shaderMesh.geometry.attributes.position,a=this.shaderMesh.geometry.attributes.randomPositon,r=o.count,u=0;u<r;u++){var h=s.getX(u);if(Math.abs(h-((n=i)>0?n-Math.floor(n):Math.ceil(n)-n))<.1){var c={x:a.getX(u),y:a.getY(u),z:a.getZ(u)};o.setXYZ(u,t.x+c.x,t.y+c.y,t.z)}}o.needsUpdate=!0,this.shaderMesh.material.uniforms.curPosition.value=this.meshes.position}},{key:"InitShader",value:function(){for(var e=new THREE.Color(0),n=new THREE.Vector3(0,0,1),i=new THREE.BufferGeometry,s=[],o=[],a=[],r=[],u=[],h=0;h<50;h++){var c=[.4*(.5-Math.random()),.4*(.5-Math.random()),1];s.push.apply(s,c),o.push.apply(o,c),a.push(e.r+Math.round(128*Math.random())/255,e.g+Math.round(128*Math.random())/255,e.b+Math.round(128*Math.random())/255,1),u.push(10),r.push(Math.random())}var l=new THREE.BufferAttribute(new Float32Array(s),3);l.needsUpdate=!0,i.addAttribute("position",l),i.addAttribute("randomPositon",new THREE.BufferAttribute(new Float32Array(o),3)),i.addAttribute("color",new THREE.BufferAttribute(new Float32Array(a),4)),i.addAttribute("size",new THREE.BufferAttribute(new Float32Array(u),1)),i.addAttribute("birthTime",new THREE.BufferAttribute(new Float32Array(r),1));var d=new THREE.ShaderMaterial({uniforms:{time:{value:1},direction:{value:n},velocity:{value:.5},texture:{value:(new THREE.TextureLoader).load("./assets/images/dot.png")},curPosition:{value:this.meshes.position}},vertexShader:t.vertex,fragmentShader:t.fragment,blending:THREE.AdditiveBlending,depthTest:!0,transparent:!0});this.shaderMesh=new THREE.Points(i,d),this.meshes.add(this.shaderMesh)}}]),t}(i(n(21)).default);t.default=c,c.vertex="\n        attribute float size;\n        attribute vec4 color;\n        attribute float birthTime;\n\n\n        varying vec4 vColor;\n\n        uniform float time;\n        uniform float velocity;\n        uniform vec3 direction;\n        uniform vec3 curPosition;\n\n        void main() {\n            float vTime = 1.0 - step(birthTime, fract(time)) + (fract(time)-birthTime);\n            vec3 offset = direction * vTime * velocity;\n            vec4 mvPosition = modelViewMatrix * vec4( position + offset - curPosition, 1.0 );\n            vColor = color;\n            gl_PointSize = size * (1.0 - vTime);\n            gl_Position = projectionMatrix * mvPosition;\n        }\n    ",c.fragment="\n        varying vec4 vColor;\n        uniform sampler2D texture;\n        void main() {\n            gl_FragColor = vColor;\n            gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );\n        }\n    "},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(29)),h=i(n(4)),c=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this))).visible=!0,e.children=[],e._ontouchstart=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.children.forEach(function(e){e.emitTouchStart.apply(e,n)})},e._ontouchmove=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.children.forEach(function(e){e.emitTouchMove.apply(e,n)})},e._ontouchend=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.children.forEach(function(e){e.emitTouchEnd.apply(e,n)})},e}return(0,h.default)(t,e),(0,o.default)(t,[{key:"Start",value:function(){this.loaded=!0,this._onload()}},{key:"Update",value:function(){this.visible&&this.loaded&&this.updateChildren()}},{key:"updateChildren",value:function(){var e=this;this.children.filter(function(e){return e.visible}).forEach(function(t){t.context?t.Update():(t.parent=e,t.context=e.context,t.Start(),e.setTouchable(t.touchable))})}},{key:"End",value:function(){}},{key:"isScope",value:function(e){var n=e.x,i=e.y;if((0,u.default)((0,r.default)(t.prototype),"isScope",this).call(this,{x:n,y:i}))return!0;for(var s=this.children.filter(function(e){return e.visible}),o=0;o<s.length;o++)if(s[o].isScope({x:n,y:i}))return!0;return!1}}]),t}(i(n(18)).default);t.default=c},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4)),h=i(n(21)),c=i(n(66)),l=i(n(20)),d=function(e){function t(){var e;(0,s.default)(this,t),e=(0,a.default)(this,(0,r.default)(t).call(this));var n=new THREE.MeshPhongMaterial({side:THREE.DoubleSide,map:THREE.ImageUtils.loadTexture("./assets/images/qt/db_1.png")}),i=new THREE.MeshPhongMaterial({side:THREE.DoubleSide,map:THREE.ImageUtils.loadTexture("./assets/images/qt/db_2.png")});return e.gridPlane=new c.default(l.default.gridCount,l.default.gridCount,n,i),e.gridPlane.mesh.rotateOnAxis(new THREE.Vector3(1,0,0),Math.PI/180*90),e.visible=!0,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"Start",value:function(){this.scene.add(this.gridPlane.mesh)}},{key:"updateFaceIndex",value:function(e){this.gridPlane.updateFaceIndex(e)}}]),t}(h.default);t.default=d},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4));function h(e){var t=new THREE.BufferGeometry,n=[];return e.forEach(function(t,i){n=n.concat([t.x,t.y,t.z]),0!==i&&i!==e.length-1&&(n=n.concat([t.x,t.y,t.z]))}),t.addAttribute("position",new THREE.Float32BufferAttribute(n,3)),t}var c=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this))).visible=!0,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"updatePath",value:function(e){e.length>1?(this.pathMesh?(this.pathMesh.geometry=h(e),this.pathMesh.computeLineDistances()):(this.pathMesh=new THREE.LineSegments(h(e),new THREE.LineDashedMaterial({color:16755200,dashSize:.3,gapSize:.1,linewidth:2})),this.pathMesh.computeLineDistances(),this.scene.add(this.pathMesh)),this.pathMesh.visible=!0):this.pathMesh&&(this.pathMesh.visible=!1)}}]),t}(i(n(21)).default);t.default=c},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4)),h=i(n(43)),c=(i(n(30)),function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this))).onTouchEnd=function(){e.Toggle()},e._toggle=!1,e._onchange=function(){},e.props=e.props.concat(["toggle","onchange"]),e.children=[],e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"Start",value:function(){this.loaded=!0,this.addEventListener("touchend",this.onTouchEnd),this.background=this.children[this._toggle?1:0]}},{key:"setToggle",value:function(e){var t=this;this.toggle=e,this.eventEmitter.emit("change",this._toggle),setTimeout(function(){return t._onchange(t._toggle)},100)}},{key:"Toggle",value:function(){var e=this;this.toggle=!this._toggle,this.eventEmitter.emit("change",this._toggle),setTimeout(function(){return e._onchange(e._toggle)},100)}},{key:"toggle",set:function(e){this._toggle=e,this.background=this.children[e?1:0]}},{key:"onchange",set:function(e){this._onchange=e}}]),t}(h.default));t.default=c},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4)),h=(i(n(22)),function(e){function t(){return(0,s.default)(this,t),(0,a.default)(this,(0,r.default)(t).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"Start",value:function(){var e=this;this.parent&&this.parent.componentMap&&(this.scoreText=this.parent.componentMap.scoreText,this.overScore=this.parent.componentMap.overScore,this.highestScore=this.parent.componentMap.highestScore,this.btnAgain=this.parent.componentMap.btnAgain,this.btnShare=this.parent.componentMap.btnShare,this.gameOver=this.parent.componentMap.gameOver,this.btnAgain.addEventListener("touchend",function(){e.gameOver.visible=!1,e.parent.Replay()}))}},{key:"Update",value:function(){var e=this,t=this.store.getUnit("player");this.scoreText.content=t.state.score.toString(),t.state.score>t.state.highestScore&&t.updateHighestScore(t.state.score),this.overScore.content="分数："+t.state.score.toString(),this.highestScore.content="历史最高分数："+t.state.highestScore,this.gameOver.visible&&this.parent.gameOver&&setTimeout(function(){e.parent.paused=!0},100),this.gameOver.visible=this.parent.gameOver}}]),t}(i(n(28)).default));t.default=h},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(33)),o=i(n(2)),a=i(n(1)),r=i(n(5)),u=i(n(3)),h=i(n(4)),c=i(n(78)),l={d:[0,90],w:[90,180],a:[-180,-90],s:[-90,0]},d=function(e){function t(){var e;return(0,o.default)(this,t),(e=(0,r.default)(this,(0,u.default)(t).call(this))).startX=0,e.startY=0,e.endX=0,e.endY=0,e.direction="c",e.isTouch=!1,e.onTouchStart=e.onTouchStart.bind((0,c.default)((0,c.default)(e))),e.onTouchMove=e.onTouchMove.bind((0,c.default)((0,c.default)(e))),e.onTouchEnd=e.onTouchEnd.bind((0,c.default)((0,c.default)(e))),window.addEventListener("touchstart",e.onTouchStart,{capture:!0,passive:!1,once:!1}),window.addEventListener("touchmove",e.onTouchMove,{capture:!0,passive:!1,once:!1}),window.addEventListener("touchend",e.onTouchEnd,{capture:!0,passive:!1,once:!1}),e}return(0,h.default)(t,e),(0,a.default)(t,[{key:"unload",value:function(){window.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)}},{key:"GetSlideAngle",value:function(e,t){return 180*Math.atan2(t,e)/Math.PI}},{key:"GetSlideDirection",value:function(){var e=this.startY-this.endY,t=this.endX-this.startX;if(Math.abs(t)<2&&Math.abs(e)<2)return"c";var n,i=this.GetSlideAngle(t,e);return(0,s.default)(l).forEach(function(e){i>=l[e][0]&&i<=l[e][1]&&(n=e)}),n}},{key:"onTouchStart",value:function(e){this.paused||(this.startX=e.touches[0].pageX,this.startY=e.touches[0].pageY,this.isTouch=!0)}},{key:"onTouchMove",value:function(e){this.isTouch&&!this.paused&&(this.endX=e.changedTouches[0].pageX,this.endY=e.changedTouches[0].pageY)}},{key:"onTouchEnd",value:function(e){if(this.isTouch&&!this.paused){var t=this.store.getUnit("player");this.direction=this.GetSlideDirection(),console.log(this.direction),t.updateDirection(this.direction),this.isTouch=!1}}}]),t}(i(n(28)).default);t.default=d},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(46)),o=i(n(2)),a=i(n(1)),r=i(n(5)),u=i(n(3)),h=i(n(4)),c=function(e){function t(e){var n;return(0,o.default)(this,t),(n=(0,r.default)(this,(0,u.default)(t).call(this))).visible=!0,n.paused=!0,n.scale=.005,n.isKilled=!1,n.dead=!1,n.removed=!1,n.meshes=new THREE.Group,n.meshes.scale.set(n.scale,n.scale,n.scale),n.meshes.rotateX(THREE.Math.degToRad(90)),n.meshes.rotateY(THREE.Math.degToRad(180)),n.type=e,n.url=["./assets/bird/bird.JD","./assets/EYU/EYU.JD","./assets/EMO/emo.JD"][n.type],n.childScale=[10,4,1][n.type],n.preload(),n}return(0,h.default)(t,e),(0,a.default)(t,[{key:"Start",value:function(){this.scene.add(this.meshes)}},{key:"createMaterials",value:function(e){for(var t=[],n=0;n<e.materials.length;++n){var i=new THREE.MeshPhongMaterial({});i.copy(e.materials[n]),t.push(i)}return t}},{key:"preload",value:function(){var e=this;if(!this.loaded){var n=this;(new THREE.JDLoader).load(this.url,function(i){for(var s=0;s<i.objects.length;++s)if("Mesh"==i.objects[s].type||"SkinnedMesh"==i.objects[s].type){var o=null,a=e.createMaterials(i);if((o="SkinnedMesh"==i.objects[s].type?new THREE.SkinnedMesh(i.objects[s].geometry,a):new THREE.Mesh(i.objects[s].geometry,a))&&o.geometry.animations){var r=new THREE.AnimationMixer(o);o.mixer=r,t.mixers.push(r),console.log("moster");var u=r.clipAction(o.geometry.animations[0]);r.clipAction(o.geometry.animations[1]).setLoop(THREE.LoopOnce),u.play()}o&&(o.scale.set(e.childScale,e.childScale,e.childScale),e.meshes.add(o))}n.loaded=!0})}}},{key:"born",value:function(e){this.updatePosition(e)}},{key:"updatePosition",value:function(e){this.position=(0,s.default)({},e,{z:.01}),this.meshes.position.x=this.position.x,this.meshes.position.y=this.position.y}},{key:"updateAnimation",value:function(){var e=this.clock.getDelta();if(this.meshes.children.length>0)for(var t=0;t<this.meshes.children.length;t++){var n=this.meshes.children[t];n&&n.mixer&&n.mixer.update(e)}}},{key:"updateDirection",value:function(e){if(this.direction!==e&&this.meshes.children.length>0)switch(e){case"w":this.meshes.rotation.set(Math.PI/2,Math.PI,0,"XYZ");break;case"s":this.meshes.rotation.set(Math.PI/2,0,0,"XYZ");break;case"a":this.meshes.rotation.set(Math.PI/2,-Math.PI/2,0,"XYZ");break;case"d":this.meshes.rotation.set(Math.PI/2,Math.PI/2,0,"XYZ")}this.direction=e}},{key:"die",value:function(){for(var e=this,t=0;t<this.meshes.children.length;t++){var n=this.meshes.children[t];if(n&&n.geometry.animations&&n.mixer){var i=n.geometry.animations[0],s=n.geometry.animations[1],o=n.mixer.existingAction(i),a=n.mixer.existingAction(s);a.clampWhenFinished=!0,a.setLoop(THREE.LoopOnce),o.stop(),a.play();var r=a.getClip().duration;setTimeout(function(){e.removed=!0,e.meshes.visible=!1,e.visible=!1},1e3*r+200)}}this.paused=!1}},{key:"play",value:function(e){for(var t=0;t<this.meshes.children.length;t++){var n=this.meshes.children[t];if(n&&n.geometry.animations&&n.mixer){var i=n.geometry.animations,s=THREE.AnimationClip.findByName(i,e),o=n.mixer.existingAction(s);console.log(o),o&&o.play()}}this.paused=!1}},{key:"stop",value:function(){this.paused=!0}}]),t}(i(n(21)).default);t.default=c,c.mixers=[]},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4)),h=i(n(20)),c=i(n(113)),l=i(n(28)),d=n(41),f=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this))).max=1,e.born=1e3,e.timestamp=Date.now(),e.meshes={},e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"Update",value:function(){this.updateData(),this.updateModel()}},{key:"updateData",value:function(){var e=this.store.getUnit("enemy"),t=this.store.getUnit("ground"),n=this.store.getUnit("player");if(Date.now()-this.timestamp>=this.born&&e.state.enemies.length<=this.max){this.timestamp=Date.now();var i={x:Math.round(Math.random()*h.default.gridCount)%h.default.gridCount-h.default.gridCount/2,y:Math.round(Math.random()*h.default.gridCount)%h.default.gridCount-h.default.gridCount/2},s=n.distance(i);n.outPath(i)&&t.outBlock(i)&&e.outEnemy(i)&&s>3&&s<=30&&e.createEnemy(i)}var o=this;e.state.enemies.forEach(function(e){var n=new THREE.Vector2(e.position.x,e.position.y),i=new THREE.Vector2(e.targetPosition.x,e.targetPosition.y),s=new THREE.Vector2(e.prevPosition.x,e.prevPosition.y),a=n.distanceTo(i);if(a<=.02){var r=o.random(e.direction),u=h.default.direction[r],c={x:i.x+u.x,y:i.y+u.y};if(e.position={x:i.x,y:i.y},t.outBlock(c)&&a>3&&a<=50)e.prevPosition={x:i.x,y:i.y},e.targetPosition=c,e.direction=r;else{e.prevPosition={x:i.x,y:i.y},e.targetPosition={x:s.x,y:s.y},e.direction={w:"s",s:"w",a:"d",d:"a"}[e.direction]}}else e.position={x:n.x+(i.x-n.x)*h.default.enemyV,y:n.y+(i.y-n.y)*h.default.enemyV}}),e.updateEnemies(e.state.enemies)}},{key:"updateModel",value:function(){var e=this.store.getUnit("enemy"),t=(this.store.getUnit("ground"),this);e.state.enemies.forEach(function(e){var n=t.meshes[e.enemyId];e.isKilled?n&&!e.dead&&(console.log("die"),n.die(),e.dead=!0,n.die()):n?(n.updatePosition(e.position),n.updateDirection(e.direction)):((n=new c.default(e.typeId)).born(e.position),t.meshes[e.enemyId]=n,t.parent.models.push(n)),n.updateAnimation()})}},{key:"random",value:function(e){var t=Math.round(1e3*Math.random())%3;return{w:["w","a","d"],s:["s","d","a"],a:["a","s","w"],d:["d","w","s"]}[e][t]}},{key:"collision",value:function(){var e=this.parent.hero.meshes.children[0];if(!e)return!1;var t=e.position.clone();t.z=.2;var n=[new d.Vector3(0,1,0),new d.Vector3(1,0,0),new d.Vector3(0,-1,0),new d.Vector3(-1,0,0)],i=[];for(var s in this.meshes){var o=this.meshes[s].meshes.children[0];o&&i.push(o)}for(var a=0;a<=10;a++){for(var r=0;r<n.length;r++){if(new THREE.Raycaster(t,n[r].normalize(),0,20).intersectObjects(i,!0).find(function(e){return e.distance<=.5}))return!0}t.z+=.2}return!1}},{key:"detection",value:function(){var e=this,t=this.store.getUnit("enemy"),n=this.store.getUnit("player");return t.state.enemies.filter(function(t){return e.collision()?(e.parent.gameOver=!0,!0):!n.outPath(t.position,.1)&&(e.parent.gameOver=!0,!0)}).length>0}}]),t}(l.default);t.default=f},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(29)),h=i(n(4)),c=(i(n(42)),i(n(20))),l=(i(n(67)),i(n(66)),i(n(28))),d=i(n(76)),f=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this))).position={x:0,y:0},e.direction="w",e}return(0,h.default)(t,e),(0,o.default)(t,[{key:"Start",value:function(){this.clock.start()}},{key:"Update",value:function(){(0,u.default)((0,r.default)(t.prototype),"Update",this).call(this),this.updateData(),this.updateModel()}},{key:"updateData",value:function(){this.calculate();var e=this.clock.getDelta(),t=this.store.getUnit("player"),n=c.default.direction[this.direction],i=this.store.getUnit("ground");console.log(n),i.isPosValid(t.state.position.x+n.x*c.default.playerV*e,t.state.position.y+n.y*c.default.playerV*e)?(console.log("valid"),t.state.position.x+=n.x*c.default.playerV*e,t.state.position.y+=n.y*c.default.playerV*e):this.direction=t.state.direction,t.updatePosition(t.state.position)}},{key:"updateModel",value:function(){var e=this.store.getUnit("ground"),t=this.store.getUnit("player"),n=e.state.blocks,i=void 0===n?[]:n,s=t.state,o=s.path,a=s.position,r=this.parent.hero,u=this.parent.heroPath,h=this.parent.camera,c=this.parent.heroShader;this.parent.ground.updateFaceIndex(i.map(function(e){return e.point1})),r.updateDirection(this.direction),r.updatePosition(a),c.updatePosition(a),u.updatePath(o),h.position.x=a.x-15,h.position.y=a.y-15,h.position.z=15*Math.sqrt(3)/2,h.up=new THREE.Vector3(.5,.5,0),h.lookAt(a.x,a.y,0)}},{key:"calculate",value:function(){var e=this.store.getUnit("ground"),t=this.store.getUnit("player"),n=this.store.getUnit("enemy"),i=Math.sqrt(Math.pow(t.state.position.x-this.position.x,2)+Math.pow(t.state.position.y-this.position.y,2)),s=t.state.direction===this.direction;if(i>=1){t.state.position={x:Math.round(t.state.position.x),y:Math.round(t.state.position.y)},s||(this.direction=t.state.direction),this.position={x:t.state.position.x,y:t.state.position.y};var o=t.state.path.findIndex(function(e){return e.x===t.state.position.x&&e.y===t.state.position.y}),a=e.value(t.state.position.x,t.state.position.y);if(console.log(a),a){t.state.path.push({x:t.state.position.x,y:t.state.position.y,z:.01,d:t.state.direction});var r=e.addArea2(t.state.path);n.state.enemies.forEach(function(e){var n=Math.floor(e.position.x),i=Math.floor(e.position.y);-1!==r.findIndex(function(e){return e.point1.x<=n&&e.point1.y<=i&&e.point1.x+1>=n&&e.point1.y+1>=i})&&(e.isKilled=!0,console.log(e),t.addScore(e.score))}),t.addScore(c.default.blocksScores(r.length)),t.updatePath([{x:t.state.position.x,y:t.state.position.y,z:.01,d:t.state.direction}])}else if(-1!==o){t.state.path.push({x:t.state.position.x,y:t.state.position.y,z:.01,d:t.state.direction});var u=t.state.path.map(function(e){return e.d});if(u=d.default.uniq(u),console.log(u),u.length>=4){var h=e.addArea2(t.state.path);n.state.enemies.forEach(function(e){var n=Math.floor(e.position.x),i=Math.floor(e.position.y);-1!==h.findIndex(function(e){return e.point1.x<=n&&e.point1.y<=i&&e.point1.x+1>=n&&e.point1.y+1>=i})&&(e.isKilled=!0,console.log(e),t.addScore(e.score))}),t.addScore(c.default.blocksScores(h.length)),h.length?t.updatePath([{x:t.state.position.x,y:t.state.position.y,z:.01,d:t.state.direction}]):(t.state.path.splice(o,t.state.path.length-o),t.updatePath(t.state.path))}else{if(t.state.path.length>2){var l={w:["a","d"],a:["w","s"],s:["a","d"],d:["w","s"]}[t.state.direction],f=(t.state.path[t.state.path.length-1],t.state.path[t.state.path.length-3]);console.log(f.d),console.log(l),-1==l.indexOf(f.d)&&(t.state.path.splice(o,t.state.path.length-o),t.updatePath(t.state.path))}else t.updatePath([{x:t.state.position.x,y:t.state.position.y,z:.01,d:t.state.direction}])}}else t.state.path.push({x:t.state.position.x,y:t.state.position.y,z:.01,d:t.state.direction}),t.updatePath(t.state.path)}}},{key:"detection",value:function(){return!1}}]),t}(l.default);t.default=f},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(42)),r={w:"北",d:"东",a:"西",s:"南",c:"保持当前方向"},u=function(){function e(t,n,i){(0,s.default)(this,e),this.enemyController=n,this.playerController=t,this.gestureController=i,this.dom=document.createElement("div")}return(0,o.default)(e,[{key:"init",value:function(){this.dom.style.position="absolute",this.dom.style.top=0,this.dom.style.right=0,this.dom.style.padding="10px",this.dom.style.backgroundColor="rgba(255,255,255,0.3)",this.dom.style.color="rgb(255,255,255)",document.body.appendChild(this.dom)}},{key:"update",value:function(){this.dom.innerText=["敌人数量:"+this.enemyController.enemies.length+"个","圈地数量:"+this.playerController.blocks.length+"格","当前行驶方向:"+r[a.default.direction],"准备切换方向:"+r[this.gestureController.direction]].join("\n")}}]),e}();t.default=u},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4)),h=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this))).camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.01,10),e.scene=new THREE.Scene,e.models=[],e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"Init",value:function(e){this.canvas=e,this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.context=e.getContext("2d"),this.context.clearRect(0,0,window.innerWidth,window.innerHeight),this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.bindEvent(),this.Start(this.renderer)}},{key:"Start",value:function(){}},{key:"Render",value:function(){this.paused?this.pauseControllers():(this.renderer&&this.renderer.render(this.scene,this.camera),this.context.drawImage(this.renderer.domElement,0,0),this.WillUpdate(),this.updateChildren(),this.updateControllers(),this.updateModels(),this.Update())}},{key:"WillUpdate",value:function(){}},{key:"Update",value:function(){}},{key:"Unload",value:function(){window.removeEventListener("resize",this.onWindowResize,!1),this.unbindEvent(),this.End()}},{key:"End",value:function(){}},{key:"onWindowResize",value:function(){this.renderer&&(this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight))}},{key:"updateModels",value:function(){var e=this;this.models.filter(function(e){return e.visible}).forEach(function(t){t.context?t.Update():(t.parent=e,t.context=e.context,t.scene=e.scene,t.camera=e.camera,t.Start())})}}]),t}(i(n(19)).default);t.default=h},function(e,t,n){"use strict";var i=n(31),s=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(n(2)),a=s(n(1)),r=s(n(5)),u=s(n(3)),h=s(n(4)),c=s(n(117)),l=(s(n(22)),s(n(42)),s(n(20))),d=(s(n(116)),s(n(115))),f=s(n(114)),p=s(n(112)),v=s(n(111)),g=i(n(71)),m=s(n(44)),y=s(n(68)),_=s(n(70)),w=s(n(110)),E=s(n(67)),x=s(n(109)),T=s(n(108)),k=s(n(69)),S=s(n(43)),b=s(n(107)),M=s(n(106)),C=function(e){function t(){return(0,o.default)(this,t),(0,r.default)(this,(0,u.default)(t).apply(this,arguments))}return(0,h.default)(t,e),(0,a.default)(t,[{key:"Start",value:function(){this.gameOver=!1,this.paused=!1,this.InitUnits(),this.Init3D(),this.Init2D(),this.InitControllers()}},{key:"Update",value:function(){this.paused||this.gameOver||(this.enemyController.detection()?this.gameOver=!0:this.playerController.detection()&&(this.gameOver=!0))}},{key:"End",value:function(){this.gestureController.unload()}},{key:"InitUnits",value:function(){if(this.store){var e=this.store.getUnit("enemy"),t=this.store.getUnit("ground"),n=this.store.getUnit("player");e.init(),t.init(),n.init()}}},{key:"Init3D",value:function(){var e=10*(window.innerWidth/window.innerHeight);this.camera=new THREE.OrthographicCamera(e/-2,e/2,5,-5,1,100),this.camera.position.z=10,this.scene=new THREE.Scene,this.scene.add(new THREE.AmbientLight(16777215,1)),this.hero=new E.default,this.hero.preload("./assets/hero/nanzhu.JD"),this.hero.born(new THREE.Vector3(0,0,l.default.playerSize/2)),this.heroPath=new x.default,this.heroShader=new M.default,this.ground=new T.default,this.models=[],this.models.push(this.hero),this.models.push(this.heroPath),this.models.push(this.ground),this.models.push(this.heroShader)}},{key:"InitControllers",value:function(){this.gestureController=new p.default,this.playerController=new d.default,this.enemyController=new f.default,this.playSceneController=new v.default,this.controllers=[],this.controllers.push(this.gestureController),this.controllers.push(this.playerController),this.controllers.push(this.enemyController),this.controllers.push(this.playSceneController)}},{key:"Init2D",value:function(){var e=this;this.componentMap={},this.children=[],this.children.push((0,g.JSXComponent)(_.default,{zIndex:-1,name:"gameMask",src:"./assets/images/qt/yxzz.png",x:0,y:0,width:window.innerWidth,height:window.innerHeight})),this.children.push((0,g.JSXComponent)(_.default,{zIndex:0,name:"scoreBg",src:"./assets/images/qt/fsd.png",x:0,y:-20,width:150,height:48})),this.children.push((0,g.JSXComponent)(y.default,{zIndex:1,gutter:{h:5,v:0},width:window.innerWidth/2,height:30,x:30},(0,g.JSXComponent)(m.default,{name:"scoreText",content:"9999",width:window.innerWidth/2-60,height:30,fontSize:18,fontFamily:"NUMBER",textAlign:"left",textAlignVertical:"center",color:"#ffeb5b"})));this.children.push((0,g.JSXComponent)(w.default,{width:40,height:40,x:window.innerWidth-40,y:0,toggle:!1,onchange:function(t){e.paused=t}},(0,g.JSXComponent)(y.default,{name:"ztIcon",x:window.innerWidth-40,y:0,width:40,height:40},(0,g.JSXComponent)(_.default,{src:"./assets/images/qt/zt.png",width:20.24,height:23.32})),(0,g.JSXComponent)(y.default,{name:"ksIcon",x:window.innerWidth-40,y:0,width:40,height:40},(0,g.JSXComponent)(_.default,{src:"./assets/images/qt/ks.png",width:20.24,height:23.32}))));var t=.8*window.innerWidth,n=(window.innerHeight-t)/2;this.children.push((0,g.JSXComponent)(b.default,{name:"gameOver",zIndex:1},(0,g.JSXComponent)(k.default,{x:0,y:0,width:window.innerWidth,height:n,backgroundColor:"rgba(0,0,0,0.1)"}),(0,g.JSXComponent)(k.default,{x:.9*window.innerWidth,y:n,width:.1*window.innerWidth,height:t,backgroundColor:"rgba(0,0,0,0.1)"}),(0,g.JSXComponent)(k.default,{x:0,y:n,width:.1*window.innerWidth,height:t,backgroundColor:"rgba(0,0,0,0.1)"}),(0,g.JSXComponent)(k.default,{x:0,y:n+t,width:window.innerWidth,height:n,backgroundColor:"rgba(0,0,0,0.1)"}),(0,g.JSXComponent)(y.default,{layout:{d:"v",h:"center",v:"bottom"},x:0,y:0,width:window.innerWidth,height:n},(0,g.JSXComponent)(m.default,{name:"highestScore",content:"历史最高分数：999",textAlign:"center",textAlignVertical:"center",color:"white",width:window.innerWidth,height:40}),(0,g.JSXComponent)(m.default,{name:"overScore",content:"分数：",fontFamily:"NUMBER",textAlign:"center",textAlignVertical:"center",color:"white",height:40})),(0,g.JSXComponent)(y.default,{x:0,y:n+t,width:window.innerWidth,height:60,layout:{d:"h",h:"center",v:"center"}},(0,g.JSXComponent)(S.default,{name:"btnAgain",background:(0,g.JSXComponent)(y.default,null,(0,g.JSXComponent)(_.default,{src:"./assets/images/qt/lsan.png",width:70,height:24})),content:(0,g.JSXComponent)(y.default,null,(0,g.JSXComponent)(_.default,{src:"./assets/images/qt/zwyj.png",width:63.6,height:16}))}),(0,g.JSXComponent)(S.default,{name:"btnShare",background:(0,g.JSXComponent)(y.default,null,(0,g.JSXComponent)(_.default,{src:"./assets/images/qt/hsan.png",width:70,height:24})),content:(0,g.JSXComponent)(y.default,null,(0,g.JSXComponent)(_.default,{src:"./assets/images/qt/fx.png",width:40.4,height:16.4}))})),(0,g.JSXComponent)(m.default,{content:"当前排名：20",x:20,y:window.innerHeight-60,textAlign:"left",textAlignVertical:"center",width:window.innerWidth/2,height:40,color:"white"})))}},{key:"Replay",value:function(){this.End(),this.Start()}}]),t}(c.default);t.default=C},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=function(){function e(t){(0,s.default)(this,e),this.source=t,this.loadedSize=0,this.totalSize=0,this.loaded=!1}return(0,o.default)(e,[{key:"download",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=new XMLHttpRequest;n.onload=function(){e.loadedSize=e.totalSize,e.loaded=!0},n.onprogress=function(n){e.totalSize=n.total,e.loadedSize=n.loaded,t()},n.open("get",this.source,!0),n.send()}}]),e}(),r=function(){function e(){(0,s.default)(this,e),this.loadedSize=0,this.totalSize=0,this.percent=0,this.sources=[],this.preloading=!1,this.loaders=[]}return(0,o.default)(e,[{key:"addSource",value:function(e){this.preloading&&this.download(e),this.sources.push(e)}},{key:"preload",value:function(){var e=this;this.preloading=!0,this.loaders=[],this.sources.forEach(function(t){e.download(t)})}},{key:"download",value:function(e){var t=this,n=new a(e);n.download(function(){return t.update()}),this.loaders.push(n)}},{key:"update",value:function(){var e=this;this.loadedSize=0,this.totalSize=0,this.loaders.forEach(function(t){e.loadedSize+=t.loadedSize,e.totalSize+=t.totalSize}),0===this.totalSize?this.percent=0:this.percent=100*this.loadedSize/this.totalSize}}]),e}();t.default=r},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4)),h=i(n(19)),c=i(n(22)),l=i(n(119)),d=function(e){function t(){return(0,s.default)(this,t),(0,a.default)(this,(0,r.default)(t).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"Start",value:function(){var e;this.precent=0,this.context.fillStyle="#f090b2",this.context.fillRect(0,0,window.innerWidth,window.innerHeight);this.preload=new l.default,(e=this.preload.sources).push.apply(e,["assets/fonts/04B_03_.svg","assets/fonts/04B_03_.ttf","assets/audio/button.wav","assets/audio/bird.wav","assets/audio/coin.wav","assets/audio/eyu.wav","assets/audio/circle.mp3","assets/audio/die.mp3","assets/audio/bgm.mp3","assets/audio/walk.wav","assets/audio/game over.mp3","assets/audio/win.wav","assets/audio/item.mp3","assets/bird/bird.png","assets/bird/帧数表.txt","assets/bird/bird.JD","assets/EMO/帧数表.txt","assets/EMO/emo.png","assets/EMO/emo.JD","assets/EYU/EYU.JD","assets/EYU/帧数表.txt","assets/EYU/EYU .png","assets/hero/帧数表.txt","assets/images/qt/db_1.png","assets/images/qt/db_2.png","assets/fonts/04B_03_.ttf?da1a9fbcd9ded63df072427001b24e21","assets/hero/nanzhu.png","assets/images/qt/dj_1.png","assets/images/qt/fhyx.png","assets/images/qt/gjx.png","assets/images/qt/fx.png","assets/images/qt/hosan.png","assets/images/qt/dj_2.png","assets/images/qt/fs.png","assets/images/qt/ks.png","assets/images/qt/jstd.png","assets/images/qt/ksyx.png","assets/images/qt/jszz.png","assets/hero/nanzhu.JD","assets/images/qt/phb_fg.png","assets/images/qt/hsan.png","assets/images/qt/lsan.png","assets/images/qt/pm_qh1.png","assets/images/qt/pm_qh2.png","assets/images/qt/phb.png","assets/images/qt/pm1.png","assets/images/qt/logo.png","assets/images/qt/pm2.png","assets/images/qt/ssjt.png","assets/images/qt/xjl.png","assets/images/qt/xzzj.png","assets/images/qt/zt.png","assets/images/qt/pm3.png","assets/images/qt/phb_bg.jpg","assets/images/qt/zwyj.png","assets/images/qt/yxzz.png","assets/images/qt/qd.png","assets/images/qt/zy_bg.jpg","assets/女主/nvzhu.JD","assets/女主/nvzhu.png"]),this.preload.preload()}},{key:"Update",value:function(){this.context.clearRect(0,0,window.innerWidth,window.innerHeight),this.context.fillStyle="#f090b2",this.context.fillRect(0,0,window.innerWidth,window.innerHeight),this.context.fillStyle="white",this.context.font="30px Times New Roman";var e=this.precent.toFixed(0)+"%",t=this.context.measureText(e);this.context.fillText(e,window.innerWidth/2-t.width/2,window.innerHeight/2),this.precent=this.preload.percent,100===this.precent&&c.default.push("/home",{})}},{key:"End",value:function(){this.context.fillStyle="#f090b2",this.context.fillRect(0,0,window.innerWidth,window.innerHeight)}}]),t}(h.default);t.default=d},,,,,function(e,t,n){"use strict";var i=n(31),s=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(n(2)),a=s(n(1)),r=s(n(5)),u=s(n(3)),h=s(n(4)),c=s(n(19)),l=s(n(22)),d=i(n(71)),f=s(n(70)),p=(s(n(44)),s(n(43))),v=(s(n(68)),s(n(74))),g=function(e){function t(){return(0,o.default)(this,t),(0,r.default)(this,(0,u.default)(t).apply(this,arguments))}return(0,h.default)(t,e),(0,a.default)(t,[{key:"Start",value:function(){var e=this;this.context.fillStyle="white",this.context.fillRect(0,0,window.innerWidth,window.innerHeight),this.children.push((0,d.JSXComponent)(f.default,{src:"./assets/images/qt/zy_bg.jpg",x:0,y:0,width:window.innerWidth,height:window.innerHeight,zIndex:-1}));var t=.78*window.innerWidth,n=t/599*144;this.children.push((0,d.JSXComponent)(f.default,{src:"./assets/images/qt/logo.png",x:(window.innerWidth-t)/2,y:.68*n,width:t,height:n})),this.children.push((0,d.JSXComponent)(f.default,{src:"./assets/images/qt/phb.png",x:20,y:window.innerHeight-50,width:47,height:44}));this.children.push((0,d.JSXComponent)(p.default,{background:(0,d.JSXComponent)(f.default,{src:"./assets/images/qt/ctms.png",x:window.innerWidth/2-92.5,y:window.innerHeight-140,width:185,height:51}),x:window.innerWidth/2-92.5,y:window.innerHeight-140,width:185,height:51,ontouchstart:function(){return e.startSoundSpeaker.play()},ontouchend:function(){return l.default.push("/play")}})),this.startSoundSpeaker=new v.default("assets/audio/button.wav"),this.startSoundSpeaker.volume=Number.MAX_VALUE,this.startSoundSpeaker.visible=!0,this.soundManager.addSpeaker(this.startSoundSpeaker)}},{key:"Update",value:function(){}},{key:"End",value:function(){}}]),t}(c.default);t.default=g},,,function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=function(){function e(){(0,s.default)(this,e),this.target={position:{x:0,y:0,z:0},up:{x:0,y:0,z:1},forward:{x:0,y:1,z:0}},this.index=e.Index++}return(0,o.default)(e,[{key:"bindTarget",value:function(e){this.target=e}},{key:"Start",value:function(){}},{key:"Update",value:function(){if(this.ctx&&this.target&&this.target.position&&this.target.forward&&this.target.up){var e=this.target,t=e.position,n=e.forward,i=e.up,s=this.ctx.listener;s.forwardX?(s.forwardX.setValueAtTime(n.x,this.ctx.currentTime),s.forwardY.setValueAtTime(n.y,this.ctx.currentTime),s.forwardZ.setValueAtTime(n.z,this.ctx.currentTime),s.upX.setValueAtTime(i.x,this.ctx.currentTime),s.upY.setValueAtTime(i.y,this.ctx.currentTime),s.upZ.setValueAtTime(i.z,this.ctx.currentTime),s.positionX.setValueAtTime(t.x,this.ctx.currentTime),s.positionY.setValueAtTime(t.y,this.ctx.currentTime),s.positionZ.setValueAtTime(t.z,this.ctx.currentTime)):(s.setOrientation(n.x,n.y,n.z,i.x,i.y,i.z),s.setPosition(t.x,t.y,t.z))}}},{key:"End",value:function(){}}]),e}();t.default=a,a.Index=0},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(128)),r=i(n(74));window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;var u=function(){function e(){(0,s.default)(this,e),this.ctx=new AudioContext,this.listener=new a.default,this.Speakers=[],this.loaded=!1}return(0,o.default)(e,[{key:"bindListener",value:function(e){e instanceof a.default&&(this.listener=e)}},{key:"addSpeaker",value:function(e){e instanceof r.default&&this.Speakers.push(e)}},{key:"Start",value:function(){this.loaded=!0}},{key:"Update",value:function(){var e=this;this.listener.ctx?this.listener.Update():(this.listener.ctx=this.ctx,this.listener.Start()),this.Speakers.filter(function(e){return e.visible&&e.volume>0}).forEach(function(t){t.ctx?t.Update():(t.ctx=e.ctx,t.Start())})}},{key:"End",value:function(){this.loaded=!1}}]),e}();t.default=u},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s={RouteHistory:i(n(22)).default};t.default=s},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(130)),o=i(n(125)),a=i(n(120)),r=i(n(118)),u=i(n(105));s.default.RouteHistory.init(),s.default.RouteHistory.addRoute("/home",new o.default),s.default.RouteHistory.addRoute("/loading",new a.default),s.default.RouteHistory.addRoute("/play",new r.default),s.default.RouteHistory.addRoute("/babylon",new u.default),s.default.RouteHistory.push("/loading",{first:!0});var h=s.default.RouteHistory;t.default=h},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(0),_stringify=_interopRequireDefault(__webpack_require__(34));function getQueryStr(e,t){var n,i=String(void 0!=t?t:window.document.location.href);return(n=new RegExp("(^|)"+e+"=([^&]*)(&|$)","gi").exec(i))?decodeURIComponent(n[2]):""}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),String.prototype.startsWith||(String.prototype.startsWith=function(e){return this.match("^"+e)==e}),window.WIS=function(){function loger(e,t,n){WIS.Log>e&&console.log("WIS."+t,n)}function logInfo(e,t){loger(5,e,t)}function logError(e,t){loger(10,e,t)}function logWarn(e,t){loger(15,e,t)}window.console||(window.console={log:function(){}});var mqttClient_=null,opt_={};function syncData(e){if(mqttClient_&&mqttClient_.isConnected()){e.clientid=clientid_,e.msguuid=Paho.MQTT.NewGuid(),e.createtime=(new Date).getTime();var t=new Paho.MQTT.Message((0,_stringify.default)(e));console.log(e),t.destinationName=opt_.room,t.qos=0,t.retained=!1,console.log(t),mqttClient_.send(t)}}var clientid_=null;function wsconnect(){if(clientid_)try{opt_.onReconnect&&opt_.onReconnect()}catch(e){logWarn("wsconnect",e)}else clientid_=opt_.clientId?opt_.clientId:"ws2-"+Paho.MQTT.NewGuid();(mqttClient_=new Paho.MQTT.Client(opt_.dmsHost,opt_.useSSL?Number(3001):Number(3e3),clientid_)).onConnectionLost=function(e){if(0!==e.errorCode&&null!=mqttClient_){try{mqttClient_.disconnect()}catch(e){console.log(e)}mqttClient_=null,setTimeout(wsconnect,100)}},mqttClient_.onMessageArrived=function(e){onMessage(e.destinationName,e.payloadString)},mqttClient_.connect({timeout:10,useSSL:opt_.useSSL,keepAliveInterval:60,cleanSession:!1,onSuccess:function(){mqttClient_.subscribe(opt_.room,{qos:1});try{opt_.onConnect&&opt_.onConnect()}catch(e){logInfo("mqttClient_.connect.onSuccess",e)}},onFailure:function(e){try{opt_.onConnectClose&&opt_.onConnectClose()}catch(e){logWarn("mqttClient_.connect.onFailure",e)}setTimeout(wsconnect,1e3)}})}function onMessage(room,msg){try{if(logInfo("onMessage",msg),room==opt_.room){var data=eval("("+msg+")");if(data.clientid==clientid_)return;data.recvAt=(new Date).getTime(),actionQueue_.Push(data)}else{try{msg=eval("("+msg+")")}catch(e){}null!=opt_.onCustomMessage&&opt_.onCustomMessage(msg,room)}}catch(e){logWarn("onMessage",e)}}var actionQueue_=new ActionQueue;function ActionQueue(){this.queue_=[],this.acting=!1}return ActionQueue.prototype.Push=function(e){null!=e&&(this.queue_.push(e),this.actQueue())},ActionQueue.prototype.Run=function(){setInterval(function(){opt_.currentTime=parseInt(opt_.currentTime)+50,actionQueue_.actQueue()},50)},ActionQueue.prototype.actQueue=function(){if(!this.acting){for(this.acting=!0;this.queue_.length>0;){message=this.queue_.shift();var e=(new Date).getTime();if(opt_.delay>0&&e-message.recvAt<opt_.delay)return this.queue_.unshift(message),void(this.acting=!1);"move"==message.cmd||message.cmd}this.acting=!1}},{Init:function(e){opt_.dmsHost=e.dmsHost,opt_.useSSL=!!e.useSSL,opt_.room=e.room,opt_.onConnect=e.onConnect,opt_.onReconnect=e.onReconnect,opt_.onConnectClose=e.onConnectClose,opt_.preTime=(new Date).getTime(),opt_.clientId=e.clientId?e.clientId:"",e.delay>0&&(opt_.delay=e.delay),actionQueue_.Run(),setTimeout(wsconnect,100)},SyncData:function(e){syncData(e)},Subscribe:function(e,t){t=void 0==t?1:t,mqttClient_.subscribe(e,{qos:t})},Unsubscribe:function(e){mqttClient_.unsubscribe(e)},GetTopic:function(){return opt_.room}}}(),WIS.Log=parseInt(getQueryStr("log")),WIS.Log=isNaN(WIS.Log)?0:WIS.Log},function(e,t,n){"use strict";var i=n(0),s=i(n(33)),o=i(n(34)),a=i(n(82));"undefined"==typeof Paho&&(window.Paho={}),Paho.MQTT=function(e){var t={CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,PUBREC:5,PUBREL:6,PUBCOMP:7,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14},n=function(e,t){for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n)){var i="Unknown property, "+n+". Valid properties are:";for(var n in t)t.hasOwnProperty(n)&&(i=i+" "+n);throw new Error(i)}if((0,a.default)(e[n])!==t[n])throw new Error(h(r.INVALID_TYPE,[(0,a.default)(e[n]),n]))}},i=function(e,t){return function(){return e.apply(t,arguments)}},r={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."}},u={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},h=function(e,t){var n=e.text;if(t)for(var i,s,o=0;o<t.length;o++)if(i="{"+o+"}",(s=n.indexOf(i))>0){var a=n.substring(0,s),r=n.substring(s+i.length);n=a+t[o]+r}return n},c=[0,6,77,81,73,115,100,112,3],l=[0,4,77,81,84,84,4],d=function(e,t){for(var n in this.type=e,t)t.hasOwnProperty(n)&&(this[n]=t[n])};function f(e,n){var i,s=n,o=e[n],a=o>>4,r=o&=15;n+=1;var u=0,h=1;do{if(n==e.length)return[null,s];u+=(127&(i=e[n++]))*h,h*=128}while(0!=(128&i));var c=n+u;if(c>e.length)return[null,s];var l=new d(a);switch(a){case t.CONNACK:1&e[n++]&&(l.sessionPresent=!0),l.returnCode=e[n++];break;case t.PUBLISH:var f=r>>1&3,p=g(e,n),v=_(e,n+=2,p);n+=p,f>0&&(l.messageIdentifier=g(e,n),n+=2);var m=new Paho.MQTT.Message(e.subarray(n,c));1==(1&r)&&(m.retained=!0),8==(8&r)&&(m.duplicate=!0),m.qos=f,m.destinationName=v,l.payloadMessage=m;break;case t.PUBACK:case t.PUBREC:case t.PUBREL:case t.PUBCOMP:case t.UNSUBACK:l.messageIdentifier=g(e,n);break;case t.SUBACK:l.messageIdentifier=g(e,n),n+=2,l.returnCode=e.subarray(n,c)}return[l,c]}function p(e,t,n){return t[n++]=e>>8,t[n++]=e%256,n}function v(e,t,n,i){return y(e,n,i=p(t,n,i)),i+t}function g(e,t){return 256*e[t]+e[t+1]}function m(e){for(var t=0,n=0;n<e.length;n++){var i=e.charCodeAt(n);i>2047?(55296<=i&&i<=56319&&(n++,t++),t+=3):i>127?t+=2:t++}return t}function y(e,t,n){for(var i=n,s=0;s<e.length;s++){var o=e.charCodeAt(s);if(55296<=o&&o<=56319){var a=e.charCodeAt(++s);if(isNaN(a))throw new Error(h(r.MALFORMED_UNICODE,[o,a]));o=a-56320+(o-55296<<10)+65536}o<=127?t[i++]=o:o<=2047?(t[i++]=o>>6&31|192,t[i++]=63&o|128):o<=65535?(t[i++]=o>>12&15|224,t[i++]=o>>6&63|128,t[i++]=63&o|128):(t[i++]=o>>18&7|240,t[i++]=o>>12&63|128,t[i++]=o>>6&63|128,t[i++]=63&o|128)}return t}function _(e,t,n){for(var i,s="",o=t;o<t+n;){var a=e[o++];if(a<128)i=a;else{var u=e[o++]-128;if(u<0)throw new Error(h(r.MALFORMED_UTF,[a.toString(16),u.toString(16),""]));if(a<224)i=64*(a-192)+u;else{var c=e[o++]-128;if(c<0)throw new Error(h(r.MALFORMED_UTF,[a.toString(16),u.toString(16),c.toString(16)]));if(a<240)i=4096*(a-224)+64*u+c;else{var l=e[o++]-128;if(l<0)throw new Error(h(r.MALFORMED_UTF,[a.toString(16),u.toString(16),c.toString(16),l.toString(16)]));if(!(a<248))throw new Error(h(r.MALFORMED_UTF,[a.toString(16),u.toString(16),c.toString(16),l.toString(16)]));i=262144*(a-240)+4096*u+64*c+l}}}i>65535&&(i-=65536,s+=String.fromCharCode(55296+(i>>10)),i=56320+(1023&i)),s+=String.fromCharCode(i)}return s}d.prototype.encode=function(){var e=(15&this.type)<<4,n=0,i=new Array,s=0;switch(void 0!=this.messageIdentifier&&(n+=2),this.type){case t.CONNECT:switch(this.mqttVersion){case 3:n+=c.length+3;break;case 4:n+=l.length+3}if(n+=m(this.clientId)+2,void 0!=this.willMessage){n+=m(this.willMessage.destinationName)+2;var o=this.willMessage.payloadBytes;o instanceof Uint8Array||(o=new Uint8Array(r)),n+=o.byteLength+2}void 0!=this.userName&&(n+=m(this.userName)+2),void 0!=this.password&&(n+=m(this.password)+2);break;case t.SUBSCRIBE:e|=2;for(var a=0;a<this.topics.length;a++)i[a]=m(this.topics[a]),n+=i[a]+2;n+=this.requestedQos.length;break;case t.UNSUBSCRIBE:e|=2;for(a=0;a<this.topics.length;a++)i[a]=m(this.topics[a]),n+=i[a]+2;break;case t.PUBREL:e|=2;break;case t.PUBLISH:this.payloadMessage.duplicate&&(e|=8),e=e|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(e|=1),n+=(s=m(this.payloadMessage.destinationName))+2;var r=this.payloadMessage.payloadBytes;n+=r.byteLength,r instanceof ArrayBuffer?r=new Uint8Array(r):r instanceof Uint8Array||(r=new Uint8Array(r.buffer));break;case t.DISCONNECT:}var u=function(e){var t=new Array(1),n=0;do{var i=e%128;(e>>=7)>0&&(i|=128),t[n++]=i}while(e>0&&n<4);return t}(n),h=u.length+1,d=new ArrayBuffer(n+h),f=new Uint8Array(d);if(f[0]=e,f.set(u,1),this.type==t.PUBLISH)h=v(this.payloadMessage.destinationName,s,f,h);else if(this.type==t.CONNECT){switch(this.mqttVersion){case 3:f.set(c,h),h+=c.length;break;case 4:f.set(l,h),h+=l.length}var g=0;this.cleanSession&&(g=2),void 0!=this.willMessage&&(g|=4,g|=this.willMessage.qos<<3,this.willMessage.retained&&(g|=32)),void 0!=this.userName&&(g|=128),void 0!=this.password&&(g|=64),f[h++]=g,h=p(this.keepAliveInterval,f,h)}switch(void 0!=this.messageIdentifier&&(h=p(this.messageIdentifier,f,h)),this.type){case t.CONNECT:h=v(this.clientId,m(this.clientId),f,h),void 0!=this.willMessage&&(h=v(this.willMessage.destinationName,m(this.willMessage.destinationName),f,h),h=p(o.byteLength,f,h),f.set(o,h),h+=o.byteLength),void 0!=this.userName&&(h=v(this.userName,m(this.userName),f,h)),void 0!=this.password&&(h=v(this.password,m(this.password),f,h));break;case t.PUBLISH:f.set(r,h);break;case t.SUBSCRIBE:for(a=0;a<this.topics.length;a++)h=v(this.topics[a],i[a],f,h),f[h++]=this.requestedQos[a];break;case t.UNSUBSCRIBE:for(a=0;a<this.topics.length;a++)h=v(this.topics[a],i[a],f,h)}return d};var w=function(e,n,i){this._client=e,this._window=n,this._keepAliveInterval=1e3*i,this.isReset=!1;var s=new d(t.PINGREQ).encode(),o=function(e){return function(){return a.apply(e)}},a=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(s),this.timeout=this._window.setTimeout(o(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(r.PING_TIMEOUT.code,h(r.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,this._window.clearTimeout(this.timeout),this._keepAliveInterval>0&&(this.timeout=setTimeout(o(this),this._keepAliveInterval))},this.cancel=function(){this._window.clearTimeout(this.timeout)}},E=function(e,t,n,i,s){this._window=t,n||(n=30);this.timeout=setTimeout(function(e,t,n){return function(){return e.apply(t,n)}}(i,e,s),1e3*n),this.cancel=function(){this._window.clearTimeout(this.timeout)}},x=function(t,n,i,s,o){if(!("WebSocket"in e&&null!==e.WebSocket))throw new Error(h(r.UNSUPPORTED,["WebSocket"]));if(!("localStorage"in e&&null!==e.localStorage))throw new Error(h(r.UNSUPPORTED,["localStorage"]));if(!("ArrayBuffer"in e&&null!==e.ArrayBuffer))throw new Error(h(r.UNSUPPORTED,["ArrayBuffer"]));for(var a in this._trace("Paho.MQTT.Client",t,n,i,s,o),this.host=n,this.port=i,this.path=s,this.uri=t,this.clientId=o,this._localKey=n+":"+i+("/mqtt"!=s?":"+s:"")+":"+o+":",this._msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0,localStorage)0!=a.indexOf("Sent:"+this._localKey)&&0!=a.indexOf("Received:"+this._localKey)||this.restore(a)};x.prototype.host,x.prototype.port,x.prototype.path,x.prototype.uri,x.prototype.clientId,x.prototype.socket,x.prototype.connected=!1,x.prototype.maxMessageIdentifier=65536,x.prototype.connectOptions,x.prototype.hostIndex,x.prototype.onConnectionLost,x.prototype.onMessageDelivered,x.prototype.onMessageArrived,x.prototype.traceFunction,x.prototype._msg_queue=null,x.prototype._connectTimeout,x.prototype.sendPinger=null,x.prototype.receivePinger=null,x.prototype.receiveBuffer=null,x.prototype._traceBuffer=null,x.prototype._MAX_TRACE_ENTRIES=100,x.prototype.connect=function(e){var t=this._traceMask(e,"password");if(this._trace("Client.connect",t,this.socket,this.connected),this.connected)throw new Error(h(r.INVALID_STATE,["already connected"]));if(this.socket)throw new Error(h(r.INVALID_STATE,["already connected"]));this.connectOptions=e,e.uris?(this.hostIndex=0,this._doConnect(e.uris[0])):this._doConnect(this.uri)},x.prototype.subscribe=function(e,n){if(this._trace("Client.subscribe",e,n),!this.connected)throw new Error(h(r.INVALID_STATE,["not connected"]));var i=new d(t.SUBSCRIBE);i.topics=[e],void 0!=n.qos?i.requestedQos=[n.qos]:i.requestedQos=[0],n.onSuccess&&(i.onSuccess=function(e){n.onSuccess({invocationContext:n.invocationContext,grantedQos:e})}),n.onFailure&&(i.onFailure=function(e){n.onFailure({invocationContext:n.invocationContext,errorCode:e})}),n.timeout&&(i.timeOut=new E(this,window,n.timeout,n.onFailure,[{invocationContext:n.invocationContext,errorCode:r.SUBSCRIBE_TIMEOUT.code,errorMessage:h(r.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(i),this._schedule_message(i)},x.prototype.unsubscribe=function(e,n){if(this._trace("Client.unsubscribe",e,n),!this.connected)throw new Error(h(r.INVALID_STATE,["not connected"]));var i=new d(t.UNSUBSCRIBE);i.topics=[e],n.onSuccess&&(i.callback=function(){n.onSuccess({invocationContext:n.invocationContext})}),n.timeout&&(i.timeOut=new E(this,window,n.timeout,n.onFailure,[{invocationContext:n.invocationContext,errorCode:r.UNSUBSCRIBE_TIMEOUT.code,errorMessage:h(r.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(i),this._schedule_message(i)},x.prototype.send=function(e){if(this._trace("Client.send",e),!this.connected)throw new Error(h(r.INVALID_STATE,["not connected"]));var n=new d(t.PUBLISH);n.payloadMessage=e,e.qos>0?this._requires_ack(n):this.onMessageDelivered&&(this._notify_msg_sent[n]=this.onMessageDelivered(n.payloadMessage)),this._schedule_message(n)},x.prototype.disconnect=function(){if(this._trace("Client.disconnect"),!this.socket)throw new Error(h(r.INVALID_STATE,["not connecting or connected"]));var e=new d(t.DISCONNECT);this._notify_msg_sent[e]=i(this._disconnected,this),this._schedule_message(e)},x.prototype.getTraceLog=function(){if(null!==this._traceBuffer){for(var e in this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length),this._sentMessages)this._trace("_sentMessages ",e,this._sentMessages[e]);for(var e in this._receivedMessages)this._trace("_receivedMessages ",e,this._receivedMessages[e]);return this._traceBuffer}},x.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,"@VERSION@")},x.prototype.stopTrace=function(){delete this._traceBuffer},x.prototype._doConnect=function(e){if(this.connectOptions.useSSL){var t=e.split(":");t[0]="wss",e=t.join(":")}this.connected=!1,this.connectOptions.mqttVersion<4?this.socket=new WebSocket(e,["mqttv3.1"]):this.socket=new WebSocket(e,["mqtt"]),this.socket.binaryType="arraybuffer",this.socket.onopen=i(this._on_socket_open,this),this.socket.onmessage=i(this._on_socket_message,this),this.socket.onerror=i(this._on_socket_error,this),this.socket.onclose=i(this._on_socket_close,this),this.sendPinger=new w(this,window,this.connectOptions.keepAliveInterval),this.receivePinger=new w(this,window,this.connectOptions.keepAliveInterval),this._connectTimeout=new E(this,window,this.connectOptions.timeout,this._disconnected,[r.CONNECT_TIMEOUT.code,h(r.CONNECT_TIMEOUT)])},x.prototype._schedule_message=function(e){this._msg_queue.push(e),this.connected&&this._process_queue()},x.prototype.store=function(e,n){var i={type:n.type,messageIdentifier:n.messageIdentifier,version:1};switch(n.type){case t.PUBLISH:n.pubRecReceived&&(i.pubRecReceived=!0),i.payloadMessage={};for(var s="",a=n.payloadMessage.payloadBytes,u=0;u<a.length;u++)a[u]<=15?s=s+"0"+a[u].toString(16):s+=a[u].toString(16);i.payloadMessage.payloadHex=s,i.payloadMessage.qos=n.payloadMessage.qos,i.payloadMessage.destinationName=n.payloadMessage.destinationName,n.payloadMessage.duplicate&&(i.payloadMessage.duplicate=!0),n.payloadMessage.retained&&(i.payloadMessage.retained=!0),0==e.indexOf("Sent:")&&(void 0===n.sequence&&(n.sequence=++this._sequence),i.sequence=n.sequence);break;default:throw Error(h(r.INVALID_STORED_DATA,[key,i]))}localStorage.setItem(e+this._localKey+n.messageIdentifier,(0,o.default)(i))},x.prototype.restore=function(e){var n=localStorage.getItem(e),i=JSON.parse(n),s=new d(i.type,i);switch(i.type){case t.PUBLISH:for(var o=i.payloadMessage.payloadHex,a=new ArrayBuffer(o.length/2),u=new Uint8Array(a),c=0;o.length>=2;){var l=parseInt(o.substring(0,2),16);o=o.substring(2,o.length),u[c++]=l}var f=new Paho.MQTT.Message(u);f.qos=i.payloadMessage.qos,f.destinationName=i.payloadMessage.destinationName,i.payloadMessage.duplicate&&(f.duplicate=!0),i.payloadMessage.retained&&(f.retained=!0),s.payloadMessage=f;break;default:throw Error(h(r.INVALID_STORED_DATA,[e,n]))}0==e.indexOf("Sent:"+this._localKey)?(s.payloadMessage.duplicate=!0,this._sentMessages[s.messageIdentifier]=s):0==e.indexOf("Received:"+this._localKey)&&(this._receivedMessages[s.messageIdentifier]=s)},x.prototype._process_queue=function(){for(var e=null,t=this._msg_queue.reverse();e=t.pop();)this._socket_send(e),this._notify_msg_sent[e]&&(this._notify_msg_sent[e](),delete this._notify_msg_sent[e])},x.prototype._requires_ack=function(e){var n=(0,s.default)(this._sentMessages).length;if(n>this.maxMessageIdentifier)throw Error("Too many messages:"+n);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;e.messageIdentifier=this._message_identifier,this._sentMessages[e.messageIdentifier]=e,e.type===t.PUBLISH&&this.store("Sent:",e),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},x.prototype._on_socket_open=function(){var e=new d(t.CONNECT,this.connectOptions);e.clientId=this.clientId,this._socket_send(e)},x.prototype._on_socket_message=function(e){this._trace("Client._on_socket_message",e.data),this.receivePinger.reset();for(var t=this._deframeMessages(e.data),n=0;n<t.length;n+=1)this._handleMessage(t[n])},x.prototype._deframeMessages=function(e){var t=new Uint8Array(e);if(this.receiveBuffer){var n=new Uint8Array(this.receiveBuffer.length+t.length);n.set(this.receiveBuffer),n.set(t,this.receiveBuffer.length),t=n,delete this.receiveBuffer}try{for(var i=0,s=[];i<t.length;){var o=f(t,i),a=o[0];if(i=o[1],null===a)break;s.push(a)}i<t.length&&(this.receiveBuffer=t.subarray(i))}catch(e){return void this._disconnected(r.INTERNAL_ERROR.code,h(r.INTERNAL_ERROR,[e.message,e.stack.toString()]))}return s},x.prototype._handleMessage=function(e){this._trace("Client._handleMessage",e);try{switch(e.type){case t.CONNACK:if(this._connectTimeout.cancel(),this.connectOptions.cleanSession){for(var n in this._sentMessages){var i=this._sentMessages[n];localStorage.removeItem("Sent:"+this._localKey+i.messageIdentifier)}for(var n in this._sentMessages={},this._receivedMessages){var s=this._receivedMessages[n];localStorage.removeItem("Received:"+this._localKey+s.messageIdentifier)}this._receivedMessages={}}if(0!==e.returnCode){this._disconnected(r.CONNACK_RETURNCODE.code,h(r.CONNACK_RETURNCODE,[e.returnCode,u[e.returnCode]]));break}this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);var o=new Array;for(var a in this._sentMessages)this._sentMessages.hasOwnProperty(a)&&o.push(this._sentMessages[a]);for(var c=0,l=(o=o.sort(function(e,t){return e.sequence-t.sequence})).length;c<l;c++){if((i=o[c]).type==t.PUBLISH&&i.pubRecReceived){var f=new d(t.PUBREL,{messageIdentifier:i.messageIdentifier});this._schedule_message(f)}else this._schedule_message(i)}this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext}),this._process_queue();break;case t.PUBLISH:this._receivePublish(e);break;case t.PUBACK:(i=this._sentMessages[e.messageIdentifier])&&(delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(i.payloadMessage));break;case t.PUBREC:if(i=this._sentMessages[e.messageIdentifier]){i.pubRecReceived=!0;f=new d(t.PUBREL,{messageIdentifier:e.messageIdentifier});this.store("Sent:",i),this._schedule_message(f)}break;case t.PUBREL:s=this._receivedMessages[e.messageIdentifier];localStorage.removeItem("Received:"+this._localKey+e.messageIdentifier),s&&(this._receiveMessage(s),delete this._receivedMessages[e.messageIdentifier]);var p=new d(t.PUBCOMP,{messageIdentifier:e.messageIdentifier});this._schedule_message(p);break;case t.PUBCOMP:i=this._sentMessages[e.messageIdentifier];delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(i.payloadMessage);break;case t.SUBACK:(i=this._sentMessages[e.messageIdentifier])&&(i.timeOut&&i.timeOut.cancel(),128===e.returnCode[0]?i.onFailure&&i.onFailure(e.returnCode):i.onSuccess&&i.onSuccess(e.returnCode),delete this._sentMessages[e.messageIdentifier]);break;case t.UNSUBACK:(i=this._sentMessages[e.messageIdentifier])&&(i.timeOut&&i.timeOut.cancel(),i.callback&&i.callback(),delete this._sentMessages[e.messageIdentifier]);break;case t.PINGRESP:this.sendPinger.reset();break;case t.DISCONNECT:this._disconnected(r.INVALID_MQTT_MESSAGE_TYPE.code,h(r.INVALID_MQTT_MESSAGE_TYPE,[e.type]));break;default:this._disconnected(r.INVALID_MQTT_MESSAGE_TYPE.code,h(r.INVALID_MQTT_MESSAGE_TYPE,[e.type]))}}catch(e){return void this._disconnected(r.INTERNAL_ERROR.code,h(r.INTERNAL_ERROR,[e.message,e.stack.toString()]))}},x.prototype._on_socket_error=function(e){this._disconnected(r.SOCKET_ERROR.code,h(r.SOCKET_ERROR,[e.data]))},x.prototype._on_socket_close=function(){this._disconnected(r.SOCKET_CLOSE.code,h(r.SOCKET_CLOSE))},x.prototype._socket_send=function(e){if(1==e.type){var t=this._traceMask(e,"password");this._trace("Client._socket_send",t)}else this._trace("Client._socket_send",e);this.socket.send(e.encode()),this.sendPinger.reset()},x.prototype._receivePublish=function(e){switch(e.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(e);break;case 1:var n=new d(t.PUBACK,{messageIdentifier:e.messageIdentifier});this._schedule_message(n),this._receiveMessage(e);break;case 2:this._receivedMessages[e.messageIdentifier]=e,this.store("Received:",e);var i=new d(t.PUBREC,{messageIdentifier:e.messageIdentifier});this._schedule_message(i);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos)}},x.prototype._receiveMessage=function(e){this.onMessageArrived&&this.onMessageArrived(e.payloadMessage)},x.prototype._disconnected=function(e,t){this._trace("Client._disconnected",e,t),this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&this._connectTimeout.cancel(),this._msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1?(this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex])):(void 0===e&&(e=r.OK.code,t=h(r.OK)),this.connected?(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:e,errorMessage:t})):4===this.connectOptions.mqttVersion&&!1===this.connectOptions.mqttVersionExplicit?(this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:e,errorMessage:t}))},x.prototype._trace=function(){if(this.traceFunction){for(var e in arguments)void 0!==arguments[e]&&(arguments[e]=(0,o.default)(arguments[e]));var t=Array.prototype.slice.call(arguments).join("");this.traceFunction({severity:"Debug",message:t})}if(null!==this._traceBuffer){e=0;for(var n=arguments.length;e<n;e++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===e?this._traceBuffer.push(arguments[e]):void 0===arguments[e]?this._traceBuffer.push(arguments[e]):this._traceBuffer.push("  "+(0,o.default)(arguments[e]))}},x.prototype._traceMask=function(e,t){var n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=i==t?"******":e[i]);return n};var T=function(e,t,i,s){var o;if("string"!=typeof e)throw new Error(h(r.INVALID_TYPE,[(0,a.default)(e),"host"]));if(2==arguments.length){s=t;var u=(o=e).match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(!u)throw new Error(h(r.INVALID_ARGUMENT,[e,"host"]));e=u[4]||u[2],t=parseInt(u[7]),i=u[8]}else{if(3==arguments.length&&(s=i,i="/mqtt"),"number"!=typeof t||t<0)throw new Error(h(r.INVALID_TYPE,[(0,a.default)(t),"port"]));if("string"!=typeof i)throw new Error(h(r.INVALID_TYPE,[(0,a.default)(i),"path"]));var c=-1!=e.indexOf(":")&&"["!=e.slice(0,1)&&"]"!=e.slice(-1);o="ws://"+(c?"["+e+"]":e)+":"+t+i}for(var l=0,d=0;d<s.length;d++){var f=s.charCodeAt(d);55296<=f&&f<=56319&&d++,l++}if("string"!=typeof s||l>65535)throw new Error(h(r.INVALID_ARGUMENT,[s,"clientId"]));var p=new x(o,e,t,i,s);this._getHost=function(){return e},this._setHost=function(){throw new Error(h(r.UNSUPPORTED_OPERATION))},this._getPort=function(){return t},this._setPort=function(){throw new Error(h(r.UNSUPPORTED_OPERATION))},this._getPath=function(){return i},this._setPath=function(){throw new Error(h(r.UNSUPPORTED_OPERATION))},this._getURI=function(){return o},this._setURI=function(){throw new Error(h(r.UNSUPPORTED_OPERATION))},this._getClientId=function(){return p.clientId},this._setClientId=function(){throw new Error(h(r.UNSUPPORTED_OPERATION))},this._getOnConnectionLost=function(){return p.onConnectionLost},this._setOnConnectionLost=function(e){if("function"!=typeof e)throw new Error(h(r.INVALID_TYPE,[(0,a.default)(e),"onConnectionLost"]));p.onConnectionLost=e},this._getOnMessageDelivered=function(){return p.onMessageDelivered},this._setOnMessageDelivered=function(e){if("function"!=typeof e)throw new Error(h(r.INVALID_TYPE,[(0,a.default)(e),"onMessageDelivered"]));p.onMessageDelivered=e},this._getOnMessageArrived=function(){return p.onMessageArrived},this._setOnMessageArrived=function(e){if("function"!=typeof e)throw new Error(h(r.INVALID_TYPE,[(0,a.default)(e),"onMessageArrived"]));p.onMessageArrived=e},this._getTrace=function(){return p.traceFunction},this._setTrace=function(e){if("function"!=typeof e)throw new Error(h(r.INVALID_TYPE,[(0,a.default)(e),"onTrace"]));p.traceFunction=e},this.connect=function(e){if(n(e=e||{},{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",mqttVersion:"number"}),void 0===e.keepAliveInterval&&(e.keepAliveInterval=60),e.mqttVersion>4||e.mqttVersion<3)throw new Error(h(r.INVALID_ARGUMENT,[e.mqttVersion,"connectOptions.mqttVersion"]));if(void 0===e.mqttVersion?(e.mqttVersionExplicit=!1,e.mqttVersion=4):e.mqttVersionExplicit=!0,void 0===e.password&&void 0!==e.userName)throw new Error(h(r.INVALID_ARGUMENT,[e.password,"connectOptions.password"]));if(e.willMessage){if(!(e.willMessage instanceof k))throw new Error(h(r.INVALID_TYPE,[e.willMessage,"connectOptions.willMessage"]));if(e.willMessage.stringPayload,void 0===e.willMessage.destinationName)throw new Error(h(r.INVALID_TYPE,[(0,a.default)(e.willMessage.destinationName),"connectOptions.willMessage.destinationName"]))}if(void 0===e.cleanSession&&(e.cleanSession=!0),e.hosts){if(!(e.hosts instanceof Array))throw new Error(h(r.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));if(e.hosts.length<1)throw new Error(h(r.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));for(var t=!1,s=0;s<e.hosts.length;s++){if("string"!=typeof e.hosts[s])throw new Error(h(r.INVALID_TYPE,[(0,a.default)(e.hosts[s]),"connectOptions.hosts["+s+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(e.hosts[s])){if(0==s)t=!0;else if(!t)throw new Error(h(r.INVALID_ARGUMENT,[e.hosts[s],"connectOptions.hosts["+s+"]"]))}else if(t)throw new Error(h(r.INVALID_ARGUMENT,[e.hosts[s],"connectOptions.hosts["+s+"]"]))}if(t)e.uris=e.hosts;else{if(!e.ports)throw new Error(h(r.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(!(e.ports instanceof Array))throw new Error(h(r.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(e.hosts.length!=e.ports.length)throw new Error(h(r.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));e.uris=[];for(s=0;s<e.hosts.length;s++){if("number"!=typeof e.ports[s]||e.ports[s]<0)throw new Error(h(r.INVALID_TYPE,[(0,a.default)(e.ports[s]),"connectOptions.ports["+s+"]"]));var u=e.hosts[s],c=e.ports[s],l=-1!=u.indexOf(":");o="ws://"+(l?"["+u+"]":u)+":"+c+i,e.uris.push(o)}}}p.connect(e)},this.subscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(n(t=t||{},{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if(void 0!==t.qos&&0!==t.qos&&1!==t.qos&&2!==t.qos)throw new Error(h(r.INVALID_ARGUMENT,[t.qos,"subscribeOptions.qos"]));p.subscribe(e,t)},this.unsubscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(n(t=t||{},{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");p.unsubscribe(e,t)},this.send=function(e,t,n,i){var s;if(0==arguments.length)throw new Error("Invalid argument.length");if(1==arguments.length){if(!(e instanceof k)&&"string"!=typeof e)throw new Error("Invalid argument:"+(0,a.default)(e));if(void 0===(s=e).destinationName)throw new Error(h(r.INVALID_ARGUMENT,[s.destinationName,"Message.destinationName"]));p.send(s)}else(s=new k(t)).destinationName=e,arguments.length>=3&&(s.qos=n),arguments.length>=4&&(s.retained=i),p.send(s)},this.disconnect=function(){p.disconnect()},this.getTraceLog=function(){return p.getTraceLog()},this.startTrace=function(){p.startTrace()},this.stopTrace=function(){p.stopTrace()},this.isConnected=function(){return p.connected}};T.prototype={get host(){return this._getHost()},set host(e){this._setHost(e)},get port(){return this._getPort()},set port(e){this._setPort(e)},get path(){return this._getPath()},set path(e){this._setPath(e)},get clientId(){return this._getClientId()},set clientId(e){this._setClientId(e)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(e){this._setOnConnectionLost(e)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(e){this._setOnMessageDelivered(e)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(e){this._setOnMessageArrived(e)},get trace(){return this._getTrace()},set trace(e){this._setTrace(e)}};var k=function(e){var t;if(!("string"==typeof e||e instanceof ArrayBuffer||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array))throw h(r.INVALID_ARGUMENT,[e,"newPayload"]);t=e,this._getPayloadString=function(){return"string"==typeof t?t:_(t,0,t.length)},this._getPayloadBytes=function(){if("string"==typeof t){var e=new ArrayBuffer(m(t)),n=new Uint8Array(e);return y(t,n,0),n}return t};var n=void 0;this._getDestinationName=function(){return n},this._setDestinationName=function(e){if("string"!=typeof e)throw new Error(h(r.INVALID_ARGUMENT,[e,"newDestinationName"]));n=e};var i=0;this._getQos=function(){return i},this._setQos=function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid argument:"+e);i=e};var s=!1;this._getRetained=function(){return s},this._setRetained=function(e){if("boolean"!=typeof e)throw new Error(h(r.INVALID_ARGUMENT,[e,"newRetained"]));s=e};var o=!1;this._getDuplicate=function(){return o},this._setDuplicate=function(e){o=e}};return k.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(e){this._setDestinationName(e)},get qos(){return this._getQos()},set qos(e){this._setQos(e)},get retained(){return this._getRetained()},set retained(e){this._setRetained(e)},get duplicate(){return this._getDuplicate()},set duplicate(e){this._setDuplicate(e)}},{Client:T,Message:k,NewGuid:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n}}}(window)},function(e,t,n){"use strict";THREE.JDLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.JDLoader.prototype={constructor:THREE.JDLoader,load:function(e,t,n,i){var s=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:THREE.LoaderUtils.extractUrlBase(e);new THREE.FileLoader(this.manager).load(e,function(e){s.loadText(e,t,o)},n,i)},loadText:function(e,t,n){var i=JSON.parse(e);i&&t(this.parse(i,n))},setTexturePath:function(e){this.texturePath=e},parse:function(e,t){function n(e){if(e&&e.skin&&e.skin.skinBones.length&&e.skin.skinWeights.length)return v;var t=[];t.push(v[0]);var n=v[e.node],i={};return i.name=n.name,i.parent=0,i.pos=[n.pos[0],n.pos[1],n.pos[2]],i.scl=[n.scl[0],n.scl[1],n.scl[2]],i.rotq=[n.rotq[0],n.rotq[1],n.rotq[2],n.rotq[3]],t.push(i),t}function i(e){var t=new THREE.Matrix4;if(!v||e<0||!v[e])return t;for(var n=e;n>=0;n=v[n].parent){var i=v[n],s=new THREE.Vector3(i.pos[0],i.pos[1],i.pos[2]),o=new THREE.Vector3(i.scl[0],i.scl[1],i.scl[2]),a=new THREE.Quaternion(i.rotq[0],i.rotq[1],i.rotq[2],i.rotq[3]),r=(new THREE.Matrix4).compose(s,a,o);t.premultiply(r)}return t}function s(t){var n=-1;if(!t||!e.materials)return 0;for(var i=0;i<t.length;++i){var s=e.materials[t[i].materialIndex];if(s&&s.maps)for(var o=0;o<s.maps.length;++o)if("diffuse"==s.maps[o].type)if(n<0)n=s.maps[o].uvsIndex;else if(n!=s.maps[o].uvsIndex)return n}return n<0?0:n}function o(e,t){if(!e)return console.error("parseOffsetAnimation: no animation"),null;var n=e.fps||30,i=!0,s=e.length||-1;"frames"==e.timeline&&(i=!1,s/=n);var o=[],r=e.name||"default",u=(e.animNodes||[])[t];if(!u)return console.error("parseOffsetAnimation: animNode "+t+" is null !"),null;var h="";void 0!==u.nodeName?h=u.nodeName:void 0!==u.nodeIndex&&(h=v[u.nodeIndex].name);var c=a(e,t),d=c.sclTrackObject,f=c.posTrackObject,p=c.rotTrackObject;return l(i,n,THREE.VectorKeyframeTrack,h+".position",f,o),l(i,n,THREE.VectorKeyframeTrack,h+".scale",d,o),l(i,n,THREE.QuaternionKeyframeTrack,h+".quaternion",p,o),0===o.length?(console.error("parseOffsetAnimation: tracks.length is 0 !"),null):new THREE.AnimationClip(r,s,o)}function a(e,t){for(var n={times:[],values:[]},s={times:[],values:[]},o={times:[],values:[]},a=[],u=t;u>=0;u=v[u].parent){var c=e.animNodes[u];a=h(a=h(a=h(a,c.scl.times),c.rot.times),c.pos.times)}n.times=n.times.concat(a),s.times=s.times.concat(a),o.times=o.times.concat(a);var l=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Quaternion,p=new THREE.Matrix4,g=new THREE.Matrix4;g.getInverse(i(t));for(var m=0;m<a.length;++m)(p=r(e,t,a[m])).multiply(g),p.decompose(l,f,d),n.values.push(d.x),n.values.push(d.y),n.values.push(d.z),o.values.push(l.x),o.values.push(l.y),o.values.push(l.z),s.values.push(f.x),s.values.push(f.y),s.values.push(f.z),s.values.push(f.w);return{sclTrackObject:n,posTrackObject:o,rotTrackObject:s}}function r(e,t,n){var i=new THREE.Matrix4;if(!v||t<0||!e.animNodes[t])return i;for(var s,o,a,r,h,c,l,d,f,p,g=t;g>=0;g=v[g].parent){var m=e.animNodes[g];(o=(s=u(m.scl.times,n)).iBegin)==(a=s.iEnd)?h=new THREE.Vector3(m.scl.values[3*o],m.scl.values[3*o+1],m.scl.values[3*o+2]):(p=(n-m.scl.times[o])/(m.scl.times[a]-m.scl.times[o]),h=new THREE.Vector3(m.scl.values[3*o],m.scl.values[3*o+1],m.scl.values[3*o+2]),d=new THREE.Vector3(m.scl.values[3*a],m.scl.values[3*a+1],m.scl.values[3*a+2]),h=h.lerp(d,p)),(o=(s=u(m.pos.times,n)).iBegin)==(a=s.iEnd)?r=new THREE.Vector3(m.pos.values[3*o],m.pos.values[3*o+1],m.pos.values[3*o+2]):(p=(n-m.pos.times[o])/(m.pos.times[a]-m.pos.times[o]),r=new THREE.Vector3(m.pos.values[3*o],m.pos.values[3*o+1],m.pos.values[3*o+2]),l=new THREE.Vector3(m.pos.values[3*a],m.pos.values[3*a+1],m.pos.values[3*a+2]),r=r.lerp(l,p)),(o=(s=u(m.rot.times,n)).iBegin)==(a=s.iEnd)?c=new THREE.Quaternion(m.rot.values[4*o],m.rot.values[4*o+1],m.rot.values[4*o+2],m.rot.values[4*o+3]):(p=(n-m.rot.times[o])/(m.rot.times[a]-m.rot.times[o]),c=new THREE.Quaternion(m.rot.values[4*o],m.rot.values[4*o+1],m.rot.values[4*o+2],m.rot.values[4*o+3]),f=new THREE.Quaternion(m.rot.values[4*a],m.rot.values[4*a+1],m.rot.values[4*a+2],m.rot.values[4*a+3]),c=c.slerp(f,p));var y=(new THREE.Matrix4).compose(r,c,h);i.premultiply(y)}return i}function u(e,t){for(var n=0,i=0,s=0;s<e.length;++s){if(e[s]==t){n=i=s;break}if(e[s]>t){n=i=s;break}if(s==e.length-1){n=i=s;break}if(t<e[s+1]){n=s,i=s+1;break}}return{iBegin:n,iEnd:i}}function h(e,t){for(var n=[],i=0,s=0;i<e.length&&s<t.length;)e[i]<t[s]?(0!=n.length&&e[i]==n[n.length-1]||n.push(e[i]),++i):e[i]>t[s]?(0!=n.length&&t[s]==n[n.length-1]||n.push(t[s]),++s):(0!=n.length&&n[n.length-1]==e[i]||n.push(e[i]),++i,++s);for(;i<e.length;)0!=n.length&&e[i]==n[n.length-1]||n.push(e[i]),++i;for(;s<t.length;)0!=n.length&&t[s]==n[n.length-1]||n.push(t[s]),++s;return n}function c(e){if(!e)return console.error("parseKeyFrameAnimation: no animation"),null;var t=e.fps||30,n=!0,i=e.length||-1;"frames"==e.timeline&&(n=!1,i/=t);for(var s=[],o=e.name||"default",a=e.animNodes||[],r=0;r<a.length;r++){var u=a[r];if(u){var h="";void 0!==u.nodeName?h=u.nodeName:void 0!==u.nodeIndex&&(h=v[u.nodeIndex].name);var c=h;l(n,t,THREE.VectorKeyframeTrack,c+".position",u.pos,s),l(n,t,THREE.VectorKeyframeTrack,c+".scale",u.scl,s),l(n,t,THREE.QuaternionKeyframeTrack,c+".quaternion",u.rot,s)}}return 0===s.length?null:new THREE.AnimationClip(o,i,s)}function l(e,t,n,i,s,o){if(s&&Array.isArray(s.times)&&Array.isArray(s.values)){var a=[],r=[];if(a=a.concat(s.times),r=r.concat(s.values),!e)for(var u=0;u<a.length;++u)a[u]/=t;a&&0!=a.length&&r&&0!=r.length&&o.push(new n(i,a,r))}}var d=0,f=this,p=[],v=[],g=[],m=[],y=[],_=[],w=[];for(function(){if(p=[],void 0!==e.materials&&0!==e.materials.length){var n,i,s,o,a,r,u,h,c,l=0;for(l=0;l<e.materials.length;++l){var d=e.materials[l];if(i=new THREE.Color(16777215),s=new THREE.Color(1644825),d.diffuse&&i.fromArray(d.diffuse),d.specular&&s.fromArray(d.specular),o=void 0!==d.glossiness?d.glossiness:40,a=void 0,r=void 0,u=void 0,h=void 0,c=void 0,d.maps)for(var v=0;v<d.maps.length;++v)if(""!=d.maps[v].file)if("diffuse"==d.maps[v].type)(g=new THREE.TextureLoader).setCrossOrigin(f.crossOrigin),(a=g.load(t+d.maps[v].file)).wrapS=a.wrapT=THREE.RepeatWrapping;else if("specular"==d.maps[v].type)(g=new THREE.TextureLoader).setCrossOrigin(f.crossOrigin),(r=g.load(t+d.maps[v].file)).wrapS=r.wrapT=THREE.RepeatWrapping;else if("bump"==d.maps[v].type)(g=new THREE.TextureLoader).setCrossOrigin(f.crossOrigin),(u=g.load(t+d.maps[v].file)).wrapS=u.wrapT=THREE.RepeatWrapping;else if("normal"==d.maps[v].type)(g=new THREE.TextureLoader).setCrossOrigin(f.crossOrigin),(h=g.load(t+d.maps[v].file)).wrapS=h.wrapT=THREE.RepeatWrapping;else if("opacity"==d.maps[v].type){var g=new THREE.TextureLoader;g.setCrossOrigin(f.crossOrigin),(c=g.load(t+d.maps[v].file)).wrapS=c.wrapT=THREE.RepeatWrapping}n=new THREE.MeshPhongMaterial({name:name,color:i.getHex(),specular:s.getHex(),shininess:o,skinning:!0}),a&&(n.map=a),r&&(n.specularMap=r),u&&(n.bumpMap=u),h&&(n.normalMap=h),c&&(n.alphaMap=c,n.transparent=!0),void 0!==d.opacity&&(n.opacity=d.opacity,d.opacity<1&&(n.transparent=!0)),p.push(n)}}}(),function(){if(v=void 0!==e.hierarchy?e.hierarchy.nodes:e.nodes,Array.isArray(v)&&v.length>0)for(var t=0;t<v.length;++t)void 0!==v[t].rot&&(v[t].rotq=v[t].rot,v[t].rot=void 0);else v=[]}(),function(){var t=e.model;if(t){var o,a,r,u,h,c,l,d,f,p,w,E,x,T,k,S,b,M,C,I,A,R,P,O,N,U,H,V,L;if(t.splineShapes)for(O=0;O<t.splineShapes.length&&void 0!=(N=t.splineShapes[O]);++O)for(P=i(C=N.node),H=0;H<N.splines.length;++H){for((h=new THREE.BufferGeometry).name=N.name,N.splines.length>1&&(h.name+="_SubSpline"+H),L=new THREE.CurvePath,V=N.splines[H],o=0;o+2<V.points.length;o+=3)(E=new THREE.Vector3(V.points[o],V.points[o+1],V.points[o+2])).applyMatrix4(P),V.points[o]=E.x,V.points[o+1]=E.y,V.points[o+2]=E.z;for(o=0;o+11<V.points.length;o+=9)U=new THREE.CubicBezierCurve3(new THREE.Vector3(V.points[o],V.points[o+1],V.points[o+2]),new THREE.Vector3(V.points[o+3],V.points[o+4],V.points[o+5]),new THREE.Vector3(V.points[o+6],V.points[o+7],V.points[o+8]),new THREE.Vector3(V.points[o+9],V.points[o+10],V.points[o+11])),L.add(U);h.setFromPoints(L.getPoints(N.steps+1)),g.push(h),y.push("Line"),_.push(N),m.push(C)}if(t.meshes)for(var q=0;q<t.meshes.length;++q){if(h=new THREE.BufferGeometry,void 0==(l=t.meshes[q]))return;if(l.name&&(h.name=l.name),void 0==(f=l.verts))return;if(void 0==(w=l.vertElement))return;if(T=l.face,k=w.vertIndices,S=w.normals,w.colors,b=w.uvs,M=l.skin,void 0==(C=l.node)||!(C>=0&&C<v.length))return;if(!((I=v[C])&&I.pos&&I.rotq&&I.scl))return;if(void 0==T)return;if(A=T.vertElementIndices,R=T.groups,!A||!R)return;P=i(C),d=k.length;var D=new Float32Array(3*d);for(p=0;p<d;++p)o=3*k[p],a=3*p,(E=new THREE.Vector3(f[o],f[o+1],f[o+2])).applyMatrix4(P),D[a]=E.x,D[a+1]=E.y,D[a+2]=E.z;if(h.addAttribute("position",new THREE.BufferAttribute(D,3)),void 0!==S&&S.length>0){var B=(new THREE.Matrix3).getNormalMatrix(P),z=new Float32Array(S);for(o=0;o+2<S.length;o+=3)(x=new THREE.Vector3(S[o],S[o+1],S[o+2])).applyMatrix3(B).normalize(),z[o]=x.x,z[o+1]=x.y,z[o+2]=x.z;h.addAttribute("normal",new THREE.BufferAttribute(z,3))}if(void 0!==b&&b.length>0){o=(o=s(R))<b.length?o:0;var j=new Float32Array(b[o]);h.addAttribute("uv",new THREE.BufferAttribute(j,2)),b.length>1&&(o=0==o?1:0,j=new Float32Array(b[o]),h.addAttribute("uv2",new THREE.BufferAttribute(j,2)))}var W=new Uint32Array(A);h.setIndex(new THREE.BufferAttribute(W,1)),h.groups=R,u=f.length/3;var F,J,X=[],Q=[];if(M&&M.skinBones&&M.skinWeights&&M.skinBones.length==M.skinWeights.length)for(p=0;p<u;++p){F=new THREE.Vector4(0,0,0,0),J=new THREE.Vector4(0,0,0,0);var G=0;for(r=0;r<4;++r)r<M.skinBones[p].length?(F.setComponent(r,M.skinBones[p][r]),J.setComponent(r,M.skinWeights[p][r]),++G):(F.setComponent(r,0),J.setComponent(r,0));for(;G<M.skinWeights[p].length;)J.addScalar(.25*M.skinWeights[p][G]),++G;X.push(F),Q.push(J)}if(X.length>0&&Q.length>0)for(c="SkinnedMesh",h.addAttribute("skinIndex",new THREE.Float32BufferAttribute(new Float32Array(4*d),4)),h.addAttribute("skinWeight",new THREE.Float32BufferAttribute(new Float32Array(4*d),4)),p=0;p<d;++p)F=X[o=k[p]],J=Q[o],h.attributes.skinIndex.setXYZW(p,F.x,F.y,F.z,F.w),h.attributes.skinWeight.setXYZW(p,J.x,J.y,J.z,J.w);else c="Mesh";if("SkinnedMesh"==c){var Y=n(l);Y&&Y.length>0&&(h.bones=Y)}g.push(h),y.push(c),_.push(l),m.push(C)}}}(),function(){var t=e.animation;if(t&&t.keyframeAnimations&&0!=t.keyframeAnimations.length){var n,i,s,a=t.keyframeAnimations.concat(),r=[];for(i=0;i<a.length;++i)(s=c(a[i]))&&r.push(s);if(r.length>0)for(n=0;n<g.length;++n){var u=!1;if(g[n]instanceof THREE.Geometry?u=g[n].skinIndices&&g[n].skinIndices.length>0&&g[n].skinWeights&&g[n].skinWeights.length>0:g[n]instanceof THREE.BufferGeometry&&(u=g[n].attributes.skinIndex&&g[n].attributes.skinIndex.count>0&&g[n].attributes.skinWeight&&g[n].attributes.skinWeight.count>0),u)g[n].animations=r;else for(g[n].animations=[],i=0;i<a.length;++i)(s=o(a[i],m[n]))&&g[n].animations.push(s)}}}(),d=0;d<g.length;++d)g[d].computeFaceNormals(),g[d].computeBoundingSphere(),w.push({geometry:g[d],type:y[d],jd_object:_[d]});var E=function(){var e,t,n=new THREE.Sphere,i=0,s=0,o=0,a=[],r=[],u=new THREE.Vector3(0,0,0),h=new THREE.Vector3(0,0,0);if(g&&g.length){for(e=0;e<g.length;++e)g[e].boundingSphere||g[e].computeBoundingSphere(),s+=g[e].boundingSphere.radius;if(s>0){for(e=0;e<g.length;++e)t=g[e],r.push(t.boundingSphere.radius),a.push(t.boundingSphere.center),h.copy(t.boundingSphere.center),h.multiplyScalar(t.boundingSphere.radius/s),u.add(h);for(e=0;e<g.length;++e){var c=u.distanceTo(a[e]);c>=i&&(o=(i=c)+r[e])}n.center=u,n.radius=o}}return n}();return{objects:w,materials:p,jd_materials:e.materials,boundingSphere:E}}}},,,function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4)),h=i(n(47)),c=i(n(20));i(n(76));Array.prototype.equals&&console.warn("Overriding existing Array.prototype.equals. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code."),Array.prototype.equals=function(e){if(!e)return!1;if(this.length!=e.length)return!1;for(var t=0,n=this.length;t<n;t++)if(this[t]instanceof Array&&e[t]instanceof Array){if(!this[t].equals(e[t]))return!1}else if(this[t]!=e[t])return!1;return!0},Object.defineProperty(Array.prototype,"equals",{enumerable:!1});var l=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this,"ground"))).init(),e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"init",value:function(){this.state={blocks:[],points:[],paths:[],cells:[],tmpCells:[],areas:[]};for(var e=c.default.gridCount*c.default.gridCount,t=Math.floor(c.default.gridCount/2),n=0;n<e;n++){var i=(r=this.pos(n)).x,s=r.y;this.state.points.push(i>=2-t&&i<t-2&&s>=3-t&&s<t-1?0:c.default.CA_CLEAR)}var o=(c.default.gridCount-1)*(c.default.gridCount-1);for(n=0;n<o;n++){i=(r=this.cellPos(n)).x,s=r.y;this.state.cells.push(i>=1-t&&i<t-2&&s>2-t&&s<=t-1?0:c.default.CA_CLEAR)}var a=[];for(n=0;n<o;n++)if(this.state.cells[n]){var r=this.cellPos(n),u=this.cellToBlock(r.x,r.y);a.push(u)}this.addBlocks(a)}},{key:"cellPos",value:function(e){return{x:e%(c.default.gridCount-1)-c.default.gridCount/2,y:-Math.floor(e/(c.default.gridCount-1))+c.default.gridCount/2}}},{key:"cellValue",value:function(e,t){var n=this.cellIndex(e,t);return n>=0?this.state.cells[n]:0}},{key:"isCellValid",value:function(e,t){var n=Math.floor(c.default.gridCount/2);return e>=-n&&e<=n-2&&t>=2-n&&t<=n}},{key:"cellIndex",value:function(e,t){return this.isCellValid(e,t)?(c.default.gridCount-1)*(c.default.gridCount/2-t)+e+c.default.gridCount/2:-1}},{key:"cellToBlock",value:function(e,t){return{point1:{x:e,y:t},point2:{x:e+1,y:t},point3:{x:e+1,y:t-1},point4:{x:e,y:t-1},mesh:null}}},{key:"posToCells",value:function(e,t,n){var i=[];return"w"==n?(this.isCellValid(e-1,t+1)&&i.push({x:e-1,y:t+1}),this.isCellValid(e,t+1)&&i.push({x:e,y:t+1})):"d"==n?(this.isCellValid(e,t)&&i.push({x:e,y:t}),this.isCellValid(e,t+1)&&i.push({x:e,y:t+1})):"s"==n?(this.isCellValid(e,t)&&i.push({x:e,y:t}),this.isCellValid(e-1,t)&&i.push({x:e-1,y:t})):"a"==n&&(this.isCellValid(e-1,t+1)&&i.push({x:e-1,y:t+1}),this.isCellValid(e-1,t)&&i.push({x:e-1,y:t})),i}},{key:"pos",value:function(e){return{x:e%c.default.gridCount-c.default.gridCount/2,y:-Math.floor(e/c.default.gridCount)+c.default.gridCount/2}}},{key:"isPosValid",value:function(e,t){var n=Math.floor(c.default.gridCount/2);return e>=-n&&e<=n-1&&t>=1-n&&t<=n}},{key:"pointIndex",value:function(e,t){return this.isPosValid(e,t)?c.default.gridCount*(c.default.gridCount/2-t)+e+c.default.gridCount/2:-1}},{key:"value",value:function(e,t){var n=this.pointIndex(e,t);return n>=0?this.state.points[n]:0}},{key:"addBlocks",value:function(e){this.state.blocks.forEach(function(t){var n=e.findIndex(function(e){return e.point1.x===t.point1.x&&e.point1.y===t.point1.y});-1!==n&&e.splice(n,1)}),this.state.blocks=this.state.blocks.concat(e)}},{key:"findDirs",value:function(e,t){var n,i=[];return this.isCellValid(e-1,t)&&!this.cellValue(e-1,t)&&(n=this.cellToBlock(e-1,t),-1!=this.state.paths.indexOf(this.pointIndex(n.point2.x,n.point2.y))&&-1!=this.state.paths.indexOf(this.pointIndex(n.point3.x,n.point3.y))||i.push("a")),this.isCellValid(e,t-1)&&!this.cellValue(e,t-1)&&(n=this.cellToBlock(e,t-1),-1!=this.state.paths.indexOf(this.pointIndex(n.point2.x,n.point2.y))&&-1!=this.state.paths.indexOf(this.pointIndex(n.point1.x,n.point1.y))||i.push("s")),this.isCellValid(e+1,t)&&!this.cellValue(e+1,t)&&(n=this.cellToBlock(e+1,t),-1!=this.state.paths.indexOf(this.pointIndex(n.point1.x,n.point1.y))&&-1!=this.state.paths.indexOf(this.pointIndex(n.point4.x,n.point4.y))||i.push("d")),this.isCellValid(e,t+1)&&!this.cellValue(e,t+1)&&(n=this.cellToBlock(e,t+1),-1!=this.state.paths.indexOf(this.pointIndex(n.point4.x,n.point4.y))&&-1!=this.state.paths.indexOf(this.pointIndex(n.point3.x,n.point3.y))||i.push("w")),i}},{key:"floodFill",value:function(e,t,n){var i=n,s=[],o=6*c.default.gridCount*c.default.gridCount,a=0;s.push({x:e,y:t});do{var r,u=s.shift();if(u)e=u.x,t=u.y,-1==i.indexOf(this.cellIndex(e,t))&&i.push(this.cellIndex(e,t)),this.isCellValid(e-1,t)&&(r=this.cellToBlock(e-1,t),0==this.cellValue(e-1,t)&&(-1!=this.state.paths.indexOf(this.pointIndex(r.point2.x,r.point2.y))&&-1!=this.state.paths.indexOf(this.pointIndex(r.point3.x,r.point3.y))||-1==i.indexOf(this.cellIndex(e-1,t))&&(i.push(this.cellIndex(e-1,t)),s.push({x:e-1,y:t})))),this.isCellValid(e,t-1)&&(r=this.cellToBlock(e,t-1),0==this.cellValue(e,t-1)&&(-1!=this.state.paths.indexOf(this.pointIndex(r.point1.x,r.point1.y))&&-1!=this.state.paths.indexOf(this.pointIndex(r.point2.x,r.point2.y))||-1==i.indexOf(this.cellIndex(e,t-1))&&(i.push(this.cellIndex(e,t-1)),s.push({x:e,y:t-1})))),this.isCellValid(e+1,t)&&(r=this.cellToBlock(e+1,t),0==this.cellValue(e+1,t)&&(-1!=this.state.paths.indexOf(this.pointIndex(r.point1.x,r.point1.y))&&-1!=this.state.paths.indexOf(this.pointIndex(r.point4.x,r.point4.y))||-1==i.indexOf(this.cellIndex(e+1,t))&&(i.push(this.cellIndex(e+1,t)),s.push({x:e+1,y:t})))),this.isCellValid(e,t+1)&&(r=this.cellToBlock(e,t+1),0==this.cellValue(e,t+1)&&(-1!=this.state.paths.indexOf(this.pointIndex(r.point3.x,r.point3.y))&&-1!=this.state.paths.indexOf(this.pointIndex(r.point4.x,r.point4.y))||-1==i.indexOf(this.cellIndex(e,t+1))&&(i.push(this.cellIndex(e,t+1)),s.push({x:e,y:t+1}))))}while(a++<o&&s.length);return i}},{key:"updatePath",value:function(e){var t=this;this.state.paths=e.map(function(e){return t.pointIndex(e.x,e.y)})}},{key:"addArea2",value:function(e){var t={points:e,mesh:null},n=this;this.state.paths=e.map(function(e){return n.pointIndex(e.x,e.y)});for(var i=[],s=0;s<t.points.length;s++){for(var o=this.posToCells(t.points[s].x,t.points[s].y,t.points[s].d),a=[],r=0;r<o.length;r++)if(0==this.cellValue(o[r].x,o[r].y)){var u=this.floodFill(o[r].x,o[r].y,[]);u=u.sort(),a.push(u)}var h=[];console.log(a),a.length>=2&&(console.log(a[0].equals(a[1])),a[0].equals(a[1])||(a[0].length>=a[1].length?h=a[1]:a[0].length<a[1].length&&(h=a[0])));for(var l=0;l<h.length;l++){this.state.cells[h[l]]=c.default.CA_CLEAR;var d=this.cellPos(h[l]),f=this.cellToBlock(d.x,d.y);this.state.points[this.pointIndex(f.point1.x,f.point1.y)]=c.default.CA_CLEAR,this.state.points[this.pointIndex(f.point2.x,f.point2.y)]=c.default.CA_CLEAR,this.state.points[this.pointIndex(f.point3.x,f.point3.y)]=c.default.CA_CLEAR,this.state.points[this.pointIndex(f.point4.x,f.point4.y)]=c.default.CA_CLEAR,i.push(f)}}return console.log(i),i.length&&this.addBlocks(i),i}},{key:"addArea",value:function(e){var t={points:e,mesh:null},n=t.points[0],i=n.x,s=n.y,o=n.x,a=n.y;t.points.forEach(function(e){e.x>i&&(i=e.x),e.y>s&&(s=e.y),e.x<o&&(o=e.x),e.y<a&&(a=e.y)});for(var r=[],u=t.points.length,h=o;h<=i;h++)for(var c=-1,l=s;l>a;l--){var d={point1:{x:h,y:l},point2:{x:h+1,y:l},point3:{x:h+1,y:l+1},point4:{x:h,y:l+1},mesh:null};1===t.points.filter(function(e,n){var i=t.points[(u+n-1)%u],s=t.points[(u+n+1)%u];return d.point1.x===e.x&&d.point1.y===e.y&&(d.point2.x===i.x&&d.point2.y===i.y||d.point2.x===s.x&&d.point2.y===s.y)}).length&&(c+=1),c%2==0&&r.push(d)}return this.addBlocks(r),this.state.areas.push(t),r}},{key:"outBlock",value:function(e){return 0===this.state.blocks.filter(function(t){return t.point1.x===e.x&&t.point1.y===e.y||t.point3.x===e.x&&t.point3.y===e.y}).length}},{key:"unitAction",value:function(e){var t=e.type,n=e.payload;console.log(t,n)}}]),t}(h.default);t.default=l},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4)),h=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this,"player"))).init(),e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"init",value:function(){this.state={direction:"w",position:{x:0,y:0},path:[{x:0,y:0,z:.01,d:"w"}],score:0,highestScore:this.state.highestScore||0,playing:!0}}},{key:"distance",value:function(e){return Math.sqrt(Math.pow(this.state.position.x-e.x,2)+Math.pow(this.state.position.y-e.y,2))}},{key:"outPath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.state.path.length<=1||0===this.state.path.filter(function(n){var i=Math.abs(n.x-e.x),s=Math.abs(n.y-e.y);return i<=t&&s<=t}).length}},{key:"updatePosition",value:function(e){this.state.position=e}},{key:"updateDirection",value:function(e){this.state.direction=e}},{key:"updatePath",value:function(e){this.state.path=e}},{key:"updateHighestScore",value:function(e){this.state.highestScore=e}},{key:"gameOver",value:function(){this.state.playing=!1}},{key:"addScore",value:function(e){this.state.score+=e}},{key:"unitAction",value:function(e){var t=e.type,n=e.payload;console.log(t,n)}}]),t}(i(n(47)).default);t.default=h},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=i(n(5)),r=i(n(3)),u=i(n(4)),h=i(n(47)),c=i(n(141)),l=i(n(20)),d=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,a.default)(this,(0,r.default)(t).call(this,"enemy"))).init(),e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"init",value:function(){this.state={enemies:[{enemyId:0,typeId:1,score:50,direction:"d",position:{x:3,y:3},targetPosition:{x:5,y:3},prevPosition:{x:3,y:3}}]}}},{key:"createEnemy",value:function(e){var t=["w","s","a","d"][Math.round(1e3*Math.random())%4],n=l.default.direction[t],i={enemyId:(0,c.default)(),typeId:Math.round(Date.now()+1e3*Math.random())%3,position:{x:e.x,y:e.y},targetPosition:{x:e.x+2*n.x,y:e.y+2*n.y},prevPosition:{x:e.x,y:e.y},direction:t};i.score=l.default.monsterScores[i.typeId],this.state.enemies.push(i)}},{key:"outEnemy",value:function(e){return 0===this.state.enemies.filter(function(t){return t.targetPosition.x===e.x&&t.targetPosition.y===e.y}).length}},{key:"updateEnemies",value:function(e){this.state.enemies=e}},{key:"unitAction",value:function(e){var t=e.type,n=e.payload;console.log(t,n)}}]),t}(h.default);t.default=d},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(167)),o=i(n(138)),a=i(n(137)),r=[new s.default,new o.default,new a.default];t.default=r},,,function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(34)),o=i(n(33)),a=i(n(2)),r=i(n(1)),u=function(){function e(){(0,a.default)(this,e),this.state={},this.prefix="game-store:",this.allKeys=[],this.loaded=!1,this.deltaTime=3e3,this.units=[]}return(0,r.default)(e,[{key:"load",value:function(){this.restore(),this.loaded=!0}},{key:"persist",value:function(){var e=this;if(0!=this.loaded){var t=this.prefix,n=[];(0,o.default)(this.state).forEach(function(i){var o=(0,s.default)(e.state[i]),a=t+i;n.push(a),localStorage.setItem(a,o)}),localStorage.setItem(t+"store:allKeys",(0,s.default)(n))}}},{key:"restore",value:function(){var e=this,t=this.prefix;JSON.parse(localStorage.getItem(t+"store:allKeys")||"[]").forEach(function(n){var i=localStorage.getItem(n);if(null!=i&&0===n.indexOf(t)){var s=n.replace(t,""),o=JSON.parse(i);e.state[s]=o}})}},{key:"getState",value:function(e){return this.state[e]}},{key:"setState",value:function(e,t){this.state[e]=t}},{key:"getUnit",value:function(e){return this.units[e]}},{key:"setUnit",value:function(e,t){this.units[e]=t}},{key:"dispatch",value:function(e){var t=e.type,n=void 0===t?"unit/update":t,i=e.payload,s=void 0===i?{}:i,o=n.split("/"),a=o[0],r=o[1];this.units[a]&&this.units[a][r]({type:n,payload:s})}}]),e}();t.default=u},,,function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(2)),o=i(n(1)),a=function(){function e(t){var n=t.history,i=t.platform,o=t.store,a=t.units,r=t.element;(0,s.default)(this,e),this.history=n,this.platform=i,this.store=o,this.units=a,this.element=r,this.loaded=!1,this.storeDeltaTime=1e3,this.lastStoreTime=0}return(0,o.default)(e,[{key:"animate",value:function(){var e=this;requestAnimationFrame(function(){return e.animate()}),this.history.current.scene.Render(),Date.now()-this.lastStoreTime>this.storeDeltaTime&&(this.lastStoreTime=Date.now(),this.units.forEach(function(e){return e.persist()}),this.store.persist())}},{key:"start",value:function(){var t=this;this.store.load(),this.units.forEach(function(e){e.setStore(t.store),e.restore()});var n=document.createElement("canvas");this.history.current.store=this.store,this.history.current.scene.Init(n),this.platform===e.Platform.H5&&(this.element instanceof HTMLElement?this.element.appendChild(n):document.body.appendChild(n)),this.loaded=!0,this.animate()}}]),e}();t.default=a,a.Platform={H5:"H5",MiniGame:"MiniGame"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getQueryObject=function(e){var t={};return(e=null==e?window.location.href:e).substring(e.lastIndexOf("?")+1).replace(/([^?&=]+)=([^?&=]*)/g,function(e,n,i){var s=decodeURIComponent(n),o=decodeURIComponent(i);return o=String(o),t[s]=o,e}),t},t.getQueryString=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?n[2]:null}},,function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.saveJson=function(e,t){var n=o();if(null!==n){var i=(0,s.default)(t);n.setItem(e,i)}},t.loadJson=function(e){var t=null;if(null===t||void 0===t){var n=o();if(null===n)return!1;t=JSON.parse(n.getItem(e))}return t};var s=i(n(34));function o(){try{if("localStorage"in window&&null!==window.localStorage)return localStorage}catch(e){return null}return null}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";(function(e){var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(n(65)),o=i(n(196)),a=n(103),r=o.default.create({baseURL:e.env.BASE_API,withCredentials:!0,timeout:5e3});r.interceptors.request.use(function(e){return(0,a.getToken)()&&(e.headers.Authorization=(0,a.getToken)()),e},function(e){console.log(e),s.default.reject(e)}),r.interceptors.response.use(function(e){return e},function(e){return console.log("err"+e),s.default.reject(e)});var u=r;t.default=u}).call(this,n(102))},function(e,t,n){"use strict";var i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.login=function(e){return(0,s.default)({url:"/api/login",method:"post",data:e})};var s=i(n(221))},,,,function(e,t,n){e.exports=n.p+"src/assets/fonts/04B_03_.svg?bd78a97701f1b3c89d450447af8a50a1"},function(e,t,n){e.exports=n.p+"src/assets/fonts/04B_03_.ttf?da1a9fbcd9ded63df072427001b24e21"},,,function(e,t,n){var i=n(40);"string"==typeof i&&(i=[[e.i,i,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0},o=n(225)(i,s);i.locals&&(e.exports=i.locals),e.hot.accept(40,function(t){!function(){var t=n(40);if("string"==typeof t&&(t=[[e.i,t,""]]),!function(e,t){var n,i=0;for(n in e){if(!t||e[n]!==t[n])return!1;i++}for(n in t)i--;return 0===i}(i.locals,t.locals))throw new Error("Aborting CSS HMR due to changed css-modules locals.");o(t)}()}),e.hot.dispose(function(){o()})},function(e,t,n){"use strict";var i=n(0);n(230);n(103),n(222),n(177),n(175);var s,o=i(n(174)),a=i(n(171)),r=i(n(168));window.THREE=n(135),n(134),n(133),n(132),window.MainWIS=(s={dmsHost:"game.hiotk.com",useSSL:!0,room:"testroom"},WIS.Init(s),WIS);var u=n(131).default;window.app=new o.default({history:u,store:new a.default,units:r.default,platform:o.default.Platform.H5}),app.start()}]),[[231,0,1]]]);